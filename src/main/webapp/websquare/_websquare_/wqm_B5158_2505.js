"use strict";(self.webpackChunkwebpack_test=self.webpackChunkwebpack_test||[]).push([[2505],{2505:(t,e,i)=>{i.r(e),i.d(e,{pivot:()=>m});var o=i(2981),s=i(1656),a=i(2085),n=i(1960),l=i(3082),r=i(6615),h=function(){};h.prototype.getPivotSheetInfo=function(t){try{for(var e,i=o.x.extend({},this.pivotSheetInfo),s=this.pivotData.colAttrs,n=this.pivotData.rowAttrs,l=this.pivotData.valAttrs,r=[],h=[],d=[],c=0;c<s.length;c++)null!=(e=this.opts.attributeLabels[s[c]])&&r.push(e);for(var p=0;p<n.length;p++)null!=(e=this.opts.attributeLabels[n[p]])&&h.push(this.opts.attributeLabels[n[p]]);for(var u=0;u<l.length;u++)d.push(this.opts.attributeLabels[l[u]]);if(i.headerX.depth)for(c=0;c<i.headerX.depth.length;c++)if(i.headerX.depth[c].valueArr)for(p=0;p<i.headerX.depth[c].valueArr.length;p++)i.headerX.depth[c].valueArr[p]=WebSquare.xml.decode(i.headerX.depth[c].valueArr[p]);if(i.headerY.depth)for(c=0;c<i.headerY.depth.length;c++)if(i.headerY.depth[c].valueArr)for(p=0;p<i.headerY.depth[c].valueArr.length;p++)i.headerY.depth[c].valueArr[p]=WebSquare.xml.decode(i.headerY.depth[c].valueArr[p]);if(i.headerX.axis.cols=r,i.headerX.axis.rows=h,i.headerY.axis.vals=d,l.length>1&&("col"==this.pivotData.valuesAxis?i.headerX.axis.cols.push(this.options.grandTotalName):"row"==this.pivotData.valuesAxis&&i.headerX.axis.rows.push(this.options.grandTotalName)),"true"==t.appendTotal){i.headerX.total={},i.headerY.total={},i.headerX.total.colSpan=1,0==this.pivotData.rowAttrs.length?i.headerX.total.rowSpan=this.pivotData.colAttrs.length:i.headerX.total.rowSpan=this.pivotData.colAttrs.length+1,0==this.pivotData.colAttrs.length?i.headerY.total.colSpan=this.pivotData.rowAttrs.length:i.headerY.total.colSpan=this.pivotData.rowAttrs.length+1,i.headerY.total.rowSpan=1,0==this.pivotData.rowAttrs.length&&i.headerX.total.rowSpan--,0==this.pivotData.colAttrs.length&&i.headerY.total.colSpan--;var v=this.options.allTotalName||this.opts.localeStrings.totals;"col"==this.pivotData.valuesAxis?(i.headerY.total.label=[v],i.headerX.total.label=d):"row"==this.pivotData.valuesAxis&&(i.headerX.total.label=[v],i.headerY.total.label=d)}return WebSquare.domain&&(i.domain=WebSquare.text.URLEncoder(WebSquare.domain)),i}catch(t){a.w.printStackTrace(t)}},h.prototype.getPivotSheetData=function(t){try{for(var e=[],i="",o=this.pivotData.rowKeys.length,s=this.pivotData.colKeys.length,n=this.pivotData.valAttrs.length,l=0;l<o;l++){for(var r=0;r<s;r++){var h=this.pivotDataArr[l*s+r];e.push(h)}if("true"==t.appendTotal)if("col"==this.pivotData.valuesAxis||1===this.pivotData.valAttrs.length)for(var d=0;d<n;d++)e.push(this.rowTotalDataArr[l*n+d]);else"row"==this.pivotData.valuesAxis&&e.push(this.rowTotalDataArr[l])}if(i+='\x3c!---PIVOTDATA--\x3e["'+e.join('","')+'"]',"true"==t.appendTotal){var c=[];if("col"==this.pivotData.valuesAxis||1===this.pivotData.valAttrs.length){for(r=0;r<s;r++)c.push(this.colTotalDataArr[r]);for(l=0;l<n;l++)c.push(this.allTotalDataArr[l])}else if("row"==this.pivotData.valuesAxis)for(l=0;l<n;l++){for(r=0;r<s;r++)c.push(this.colTotalDataArr[l*s+r]);c.push(this.allTotalDataArr[l])}i+='\x3c!---PIVOTDATA--\x3e["'+c.join('","')+'"]'}return i}catch(t){a.w.printStackTrace(t)}},h.prototype.pivotExcelDownload=function(t,e){try{var i="";t.fileName=t.fileName||"pivotExcel",t.sheetName=t.sheetName||"sheet",t.processMsg=t.processMsg||"",t.stRowIndex=t.startRowIndex+""||"0",t.startRowIndex=t.stRowIndex,t.stColumnIndex=t.startColumnIndex+""||"0",t.startColumnIndex=t.stColumnIndex,t.axisLColor=t.axisLColor||"WHITE",t.axisLFontName=t.axisLFontName||"",t.axisLFontSize=t.axisLFontSize||"",t.axisLFontColor=t.axisLFontColor||"",t.axisLFontWeight=t.axisLFontWeight||"",t.axisLTextAlign=t.axisLTextAlign||"",t.axisRColor=t.axisRColor||"YELLOW",t.axisRFontName=t.axisRFontName||"",t.axisRFontSize=t.axisRFontSize||"",t.axisRFontColor=t.axisRFontColor||"",t.axisRFontWeight=t.axisRFontWeight||"",t.axisRTextAlign=t.axisRTextAlign||"",t.axisBColor=t.axisBColor||"YELLOW",t.axisBFontName=t.axisBFontName||"",
t.axisBFontSize=t.axisBFontSize||"",t.axisBFontColor=t.axisBFontColor||"",t.axisBFontWeight=t.axisBFontWeight||"",t.axisBTextAlign=t.axisBTextAlign||"",t.headerXColor=t.headerXColor||"YELLOW",t.headerXFontName=t.headerXFontName||"",t.headerXFontSize=t.headerXFontSize||"",t.headerXFontColor=t.headerXFontColor||"",t.headerXFontWeight=t.headerXFontWeight||"",t.headerXTextAlign=t.headerXTextAlign||"",t.headerXWidth=t.headerXWidth||"",t.headerYColor=t.headerYColor||"YELLOW",t.headerYFontName=t.headerYFontName||"",t.headerYFontSize=t.headerYFontSize||"",t.headerYFontColor=t.headerYFontColor||"",t.headerYFontWeight=t.headerYFontWeight||"",t.headerYTextAlign=t.headerYTextAlign||"",t.headerYWidth=t.headerYWidth||"",t.totalXColor=t.totalXColor||"YELLOW",t.totalXFontName=t.totalXFontName||"",t.totalXFontSize=t.totalXFontSize||"",t.totalXFontColor=t.totalXFontColor||"",t.totalXFontWeight=t.totalXFontWeight||"",t.totalXWidth=t.totalXWidth||"",t.totalXTextAlign=t.totalXTextAlign||"",t.totalYColor=t.totalYColor||"YELLOW",t.totalYFontName=t.totalYFontName||"",t.totalYFontSize=t.totalYFontSize||"",t.totalYFontColor=t.totalYFontColor||"",t.totalYFontWeight=t.totalYFontWeight||"",t.totalYTextAlign=t.totalYTextAlign||"",t.totalYFormat=t.totalYFormat||"",t.totalYWidth=t.totalYWidth||"",t.bodyColor=t.bodyColor||"WHITE",t.bodyFontName=t.bodyFontName||"",t.bodyFontSize=t.bodyFontSize||"",t.bodyFontColor=t.bodyFontColor||"",t.bodyFontWeight=t.bodyFontWeight||"",t.bodyTextAlign=t.bodyTextAlign||"",t.bodyFormat=t.bodyFormat||"",t.useDataFormat=t.useDataFormat||"false",t.bodyWidth=t.bodyWidth||"",t.bodyDefaultValue=t.bodyDefaultValue||"",t.sumColor=t.sumColor||"WHITE",t.sumFontName=t.sumFontName||"",t.sumFontSize=t.sumFontSize||"",t.sumFontColor=t.sumFontColor||"",t.sumFontWeight=t.sumFontWeight||"bold",t.sumTextAlign=t.sumTextAlign||"",t.sumFormat=t.sumFormat||"",t.sumWidth=t.sumWidth||"",t.showProcess=t.showProcess||"true",t.bodyWordwrap=t.bodyWordwrap||"",t.useHeaderX=t.useHeaderX||"true",t.useHeaderY=t.useHeaderY||"true",t.useTotal=t.useTotal+""=="true"||this.options.showGrandTotal?"true":"false",t.headerYMerge=t.headerYMerge+""=="true"||this.options.headerYMerge+""=="true"?"true":"false",t.grandTotalDisplayType=this.options.grandTotalDisplayType,t.appendTotal=t.useTotal,t.separator=t.separator||",",t.autoSizeColumn=t.autoSizeColumn||"false",t.displayGridlines=t.displayGridlines||"";var o=t.sameSite||"";""!=o&&(t.sameSite=o),t.optionParam=t.optionParam||"",t.msaName=t.msaName||"",t.printSet=t.printSet||{},t.printSet.fitToPage=t.printSet.fitToPage||"false",t.printSet.landScape=t.printSet.landScape||"false",t.printSet.fitWidth=t.printSet.fitWidth||"1",t.printSet.fitHeight=t.printSet.fitHeight||"1",t.printSet.scale=t.printSet.scale||"100",t.printSet.pageSize=t.printSet.pageSize||"A4",null!=e&&void 0!==e||(e=[]);var n=this.getPivotSheetInfo(t);n.options=t,n.infoArr=e;var l=t.processMsg;l&&l.length>0?WebSquare.layer.showProcessMessage(l,{scope:this.scope_id||""}):WebSquare.layer.showProcessMessage("download...",{scope:this.scope_id||""}),i=JSON.stringify(n),i+=this.getPivotSheetData(t);var r=t.action||this.options.pivotExcelDownloadURL,h=t.msaName||this._getMsaName()||"";if(""!=h){var d="";t.action&&(d=t.action),r=s.v.getServletURL(this,h,"pivotToExcel.wq",d),t.useXHR=!0}s.v.excelDownload(r,i,"post",{scopeId:this.scope_id||"",useXHR:t.useXHR||!1})}catch(t){a.w.printStackTrace(t)}},h.prototype.pivotExcelUpload=function(t){try{var e=t.popupUrl||this.options.pivotExcelUploadPopupURL,i={};i.action=t.action||this.options.pivotExcelUploadURL;var o="false",n=t.msaName||this._getMsaName()||"";if(""!=n){var l="";t.action&&(l=t.action),i.action=s.v.getServletURL(this,n,"excelToPivot.wq",l),o="true"}i.msaName=n||"",i.postMsg=o,i.pivotID=this.id,i.sheetNo=t.sheetNo||"0",i.delim=t.delim||",",i.startRowIndex=t.startRowIndex||"0",i.startColumnIndex=t.startColumnIndex||"0",i.endColumnIndex=t.endColumnIndex||"0",i.skipSpace=t.skipSpace||"1",i.append=t.append||"0",
i.processMsg=t.processMsg||"";var r=this.modelControl.getDataComp(this.options.dataList);i.dataList=r.id||"";var h,d=r.cellIdList.length;i.columnNum=d,e=e+"?pivotID="+this.id,WebSquare.domain&&(e=e+"&"+WebSquare.text.URLEncoder(WebSquare.domain)||""),h=void 0===t.features||"string"!=typeof t.features?"top=280,height=137,left=160,width=446,location=no,menubar=no,resizable=yes,scrollbars=auto,status=no,titlebar=yes,toolbar=no":t.features,this._pivotUploadInfo=JSON.stringify(i),window.open(e,"fileupWindow",h)}catch(t){a.w.printStackTrace(t)}},h.prototype.pivotCSVDownload=function(t){try{var e="";t.fileName=t.fileName||"pivotText",t.delim=t.delim||",",t.stRowIndex=t.startRowIndex+""||"0",t.startRowIndex=t.stRowIndex,t.stColumnIndex=t.startColumnIndex+""||"0",t.startColumnIndex=t.stColumnIndex,t.processMsg=t.processMsg||"",t.useHeaderX=t.useHeaderX||"true",t.useHeaderY=t.useHeaderY||"true",t.useTotal=t.useTotal+""=="true"||this.options.showGrandTotal?"true":"false",t.grandTotalDisplayType=this.options.grandTotalDisplayType,t.appendTotal=t.useTotal;var i=t.sameSite||"";""!=i&&(t.sameSite=i);var o=this.getPivotSheetInfo(t);o.options=t;var n=t.processMsg;n&&n.length>0?WebSquare.layer.showProcessMessage(n,{scope:this.scope_id||""}):WebSquare.layer.showProcessMessage("download...",{scope:this.scope_id||""}),e=JSON.stringify(o),e+=this.getPivotSheetData(t);var l=t.action||this.options.pivotCsvDownloadURL,r=t.msaName||this._getMsaName()||"";if(""!=r){var h="";t.action&&(h=t.action),l=s.v.getServletURL(this,r,"pivotToCSV.wq",h),t.useXHR=!0}s.v.excelDownload(l,e,"post",{scopeId:this.scope_id||"",useXHR:t.useXHR||!1})}catch(t){a.w.printStackTrace(t)}},h.prototype.pivotCSVUpload=function(t){try{var e=t.popupUrl||this.options.pivotCsvUploadPopupURL,i={};i.action=t.action||this.options.pivotCsvUploadURL;var o="false",n=t.msaName||this._getMsaName()||"";if(""!=n){var l="";t.action&&(l=t.action),i.action=s.v.getServletURL(this,n,"csvToPivot.wq",l),o="true"}i.msaName=n||"",i.postMsg=o,i.delim=t.delim||",",i.escapeChar=t.escapeChar||"",i.startRow=t.startRowIndex||"0",i.startCol=t.startColumnIndex||"0",i.skipSpace=t.skipSpace||"0",i.append=t.append||"0",i.optionParam=t.optionParam||"",i.processMsg=t.processMsg||"",i.processMsg=t.processMsg||"";var r=this.modelControl.getDataComp(this.options.dataList);i.dataList=r.id||"";var h,d=r.cellIdList.length;i.columnNum=d,e=e+"?pivotID="+this.id,WebSquare.domain&&(e=e+"&"+WebSquare.text.URLEncoder(WebSquare.domain)||""),void 0!==h&&"string"==typeof h||(h="top=280,height=137,left=160,width=446,location=no,menubar=no,resizable=yes,scrollbars=auto,status=no,titlebar=yes,toolbar=no"),this._pivotUploadInfo=JSON.stringify(i),window.open(e,"csvupWindow",h)}catch(t){a.w.printStackTrace(t)}},h.prototype.fireFileReadEnd=function(t){var e=this;setTimeout((function(){n.B.fireEvent(e,"onfilereadend",t)}),10)},h.prototype.setHeaderDisplay=function(t){try{var e=[];e.push(this.render.getElementsByClassName("w2editablePivot_container_header_hiddenList")[0]),e.push(this.render.getElementsByClassName("w2editablePivot_container_header_showedValueList")[0]),e.push(this.render.getElementsByClassName("w2editablePivot_container_header_colAxisList")[0]),e.push(this.render.getElementsByClassName("w2editablePivot_container_header_rowAxisList")[0]);var i=0;if(4==e.length)for(var o=0;o<t.length;o++)t[o]?(e[o].style.display="",i+=e[o].getBoundingClientRect().height):e[o].style.display="none";this.isHiddenHeader=t,this.render.getElementsByClassName("w2editablePivot_container_header")[0].style.height=i+"px",this.resizeContentArea(),this.endHiding||(this.endHiding=!0,this.refreshRender(!0),this.endHiding=!1)}catch(t){a.w.printStackTrace(t)}},h.prototype.resizeContentArea=function(){try{this.pivotData&&this.pivotData.resizeContentArea(this.pivotDOM.pivotTABLE,this)}catch(t){a.w.printStackTrace(t)}},h.prototype.resizeContentAreaAfterSetColumnWidth=function(){try{
this.pivotData&&this.pivotData.resizeContentAreaAfterSetColumnWidth(this.pivotDOM.pivotTABLE,this)}catch(t){a.w.printStackTrace(t)}},h.prototype.setValueDisplay=function(t){try{var e=[];for(var i in t){t[i]&&e.push(i)}this.options.vals=e.join(","),this.refreshRender(!0)}catch(t){a.w.printStackTrace(t)}},h.prototype.setFixedColumn=function(t){try{var e=parseInt(t);l.D.isNumber(e)&&(this.options.fixedColumn=e,this.refreshRender(!0))}catch(t){a.w.printStackTrace(t)}},h.prototype.setFixedRow=function(t){try{var e=parseInt(t);l.D.isNumber(e)&&(this.options.fixedRow=e,this.refreshRender(!0))}catch(t){a.w.printStackTrace(t)}},h.prototype.getTotalRow=function(){try{return this.pivotData.getRowKeys().length}catch(t){a.w.printStackTrace(t)}},h.prototype.getDataLength=function(){try{return this._dataList?this._dataList.getDataLength():0}catch(t){a.w.printStackTrace(t)}},h.prototype.displayNoResultMessage=function(){try{var t=this.getElementById(this.id+"_noresult");if(this.options.noResultMessageVisible&&0==this.getDataLength()){t.innerHTML=this.options.noResultMessage,t.style.display="block";var e=document.getElementById(this.id).offsetHeight,i=document.getElementById(this.id+"_container_header").offsetHeight+3,o=document.getElementById(this.id+"_noresult"),s=parseInt(WebSquare.style.getStyle(o,"margin-top"),10)||0,n=e-i;t.style.top=i+n/2+s+"px"}else t.style.display="none"}catch(t){a.w.printStackTrace(t)}},h.prototype._pivotNumberFormatter=function(t){try{var e,i,o=0;if(this.options.digitsAfterDecimal&&!isNaN(this.options.digitsAfterDecimal)&&(o=parseInt(this.options.digitsAfterDecimal)),isNaN(t)||!isFinite(t)){if(1!=this.options.showZero||null!=t&&""!=t&&!isNaN(t))return"";t=0}if(0===t||null===t||""===t){if(!this.options.showZero)return"";t=0}return 1!=this.options.useNumberFormat||isNaN(o)?i=t+"":(i=(parseFloat(this.options.scaler)*t).toFixed(o+1),i=o>0?i.substring(0,i.indexOf(".")+o+1):i.substring(0,i.indexOf("."))),e=this._addSeparators(i,this.options.thousandsSep,this.options.decimalSep),isNaN(parseFloat(e))?""+e:""+this.options.prefix+e+this.options.suffix}catch(t){a.w.printStackTrace(t)}},h.prototype._addSeparators=function(t,e,i){try{var o,s,n,l;for(n=(s=(t+="").split("."))[0],l=s.length>1?i+s[1]:"",o=/(\d+)(\d{3})/;o.test(n);)n=n.replace(o,"$1"+e+"$2");return n+l}catch(t){a.w.printStackTrace(t)}},h.prototype.setHeaderListMouseOver=function(t){try{this.options.headerListMouseOver=t}catch(t){a.w.printStackTrace(t)}},h.prototype.setHeaderBackgroundColor=function(t,e,i){try{if(this.options.headerListMouseOver&&this.options.headerListMouseOverColor||this.options.headerBackgroundColor||i){var o;if(this.options.grandTotalName===t)o=t;else for(var s=0;s<this.columnInfoList.length;s++)if(this.columnInfoList[s].id==t){o=this.columnInfoList[s].name;break}if(!o)return;!0===e?this._applyHeaderFocusedCellIn(o,t,i):this._applyHeaderFocusedCellOut(o,t)}}catch(t){a.w.printStackTrace(t)}};var d=function(){};d.prototype.setCellEditMode=function(t){try{this.editingTD&&this.endCellEditMode(),this.editingTD=t,this.isEditting=!0;var e=t.getAttribute("data-coordinate").split(","),i=e[0],o=e[1],s=this.getInput(t);this.setInputPosition(s,i,o);var n=this.getValue(i,o);null===n?(s.setValue(""),this.isEditting=!1):(""==n?s.setValue(""):"text"==this.options.valueDataType?s.setValue(n):"bigDecimal"==this.options.numberDataType?s.setValue(WebSquare.bigDecimal(n).toFixed()):"number"==this.options.valueDataType?s.setValue(parseFloat(n)):s.setValue(n),s.select(),s.focus())}catch(t){a.w.printStackTrace(t)}},d.prototype.endCellEditMode=function(){try{var t,e=this.editingTD.getAttribute("data-coordinate").split(","),i=e[0]-0,o=e[1]-0,s=this.getInput(this.editingTD),n=s.getValue(),l=this.getValue(i,o);if(this.moveInputRenderTo(this.render),s.hide(),""==n)t=n;else if("number"==this.options.valueDataType){n=n.wq_trim();if(n=/^-?\d*\.?\d+$/.exec(n),isNaN(parseFloat(n)))return this.editingTD=null,void(this.isEditting=!1);t=parseFloat(n)+"",
"bigDecimal"==this.options.numberDataType&&""!=n&&null!=n&&(t=WebSquare.bigDecimal(n).toFixed())}else t=n;if("text"==this.options.valueDataType){if(""!=n&&s.validator.commandList.length>0){var r=n.match(s.validator.commandList[0].regExp);r&&(r=r.join("")),r!=n&&(1==this.options.autoPopupInvalidMessage&&alert(this.options.invalidMessage),t="")}s.validator.removeCommand(new WebSquare.validator.allowCharCommand(this.regExp))}if(t==l){n=this.getFormattedValue(i,o);if(this.numberFormatter){var h={rowIndex:i,colIndex:o,value:n};n=this.numberFormatter(h)}this.editingTD.innerHTML=n}else{this.valueChange=!0;var d=this.setValue(i,o,t);this.options.undoRedo&&this._dataList.undoRedoSave([d])}this.editingTD=null,this.isEditting=!1}catch(t){a.w.printStackTrace(t)}},d.prototype.handleCancelEdit=function(t){this._handleCancelEdit(t),this.editingTD=null,this.isEditting=!1},d.prototype._handleCancelEdit=function(t){try{var e=this.editingTD.getAttribute("data-coordinate").split(","),i=e[0]-0,o=e[1]-0,s=this.getValue(i,o);this.editingTD.innerHTML=s,this.getInput(this.editingTD).hide()}catch(t){a.w.printStackTrace(t,null,this)}},d.prototype.setFormattedValue=function(t){try{var e=n.B.getTarget(t.e),i=t.rowIndex,o=t.colIndex,s=this._getAggregator(i,o).format(t.value);e.innerHTML=s+t.affix}catch(t){a.w.printStackTrace(t)}},d.prototype.getInput=function(t){try{if(!this.hasInput){var e=new WebSquare.uiplugin.input(this.id+"_editingInput",{style:"position:relative;display:none;resize:none;ime-mode : disabled;",className:"$blank",dataType:this.options.valueDataType,autoPopupInvalidMessage:this.options.autoPopupInvalidMessage,invalidMessage:this.options.invalidMessage,xmlEvents:[{name:"oncopy",action:"script",param:{handler:function(t){n.B.stopPropagation(t)}}},{name:"onpaste",action:"script",param:{handler:function(t){n.B.stopPropagation(t)}}}]},t);e.writeTo(this.render),e.event.addListener(e.render,"onclick",this.event.bindAsEventListener(this,(function(t){}))),e.event.addListener(e.render,"onfocusout",this.event.bindAsEventListener(this,(function(t){}))),e.activate(),e.options.enterBlur=!1,this.editingInput=e,this.hasInput=!0}return this.editingInput}catch(t){a.w.printStackTrace(t)}},d.prototype.setInputPosition=function(t,e,i){try{var o,s=0;this.editingTD.style.padding="0px",this.editingTD.innerHTML="";var n=this.editingTD.getBoundingClientRect();if(this.moveInputRenderTo(this.editingTD),o=n.width-8,s=n.height-3,parseInt(e)+1==this.options.fixedRow&&s--,t.render.style.width=o+"px",t.render.style.height=s+"px",l.D.isIE()&&(t.render.style.lineHeight=n.height+"px"),t.render.style.textAlign=""==this.editingTD.style.textAlign?"center":this.editingTD.style.textAlign,"text"==this.options.valueDataType){if(this.options.allowCharFormatter){var r=l.D.getGlobalFunction(this.options.allowCharFormatter,this.scope_id);"function"==typeof r&&(this.regExp=r(this.getDataListRowIndex(e,i)),t.validator.addCommand(new WebSquare.validator.allowCharCommand(this.regExp)))}}else t.validator.addCommand(new WebSquare.validator.allowCharCommand("+\\-.0-9"));t.show()}catch(t){a.w.printStackTrace(t)}},d.prototype.setCellEditModeWhere=function(t,e){},d.prototype.endCellEditModeWhere=function(t,e){},d.prototype.getCoordinate=function(t){try{var e=t.getAttribute("data-coordinate").split(",");return{rowIndex:parseInt(e[0]),colIndex:parseInt(e[1])}}catch(t){a.w.printStackTrace(t)}};var c=function(){};c.prototype.getRecord=function(t){try{for(var e={},i=this.modelControl.getDataComp(this.options.dataList),o=i.cellIdList.length,s=0;s<i.cellIdList.length;s++){var n=i.getCellInfo(s);n&&("expression"==n.options.inputType?e[n.id]=n.getExpressionValue(t):(e[n.id]=i.dataArr[t*o+s],null==e[n.id]&&(e[n.id]="")))}return e}catch(t){a.w.printStackTrace(t)}},c.prototype._getAggregator=function(t,e){try{var i=this.pivotData.rowKeys[t],o=this.pivotData.colKeys[e];return this.getAggregator(i,o)}catch(t){a.w.printStackTrace(t)}},c.prototype.getAggregator=function(t,e,i){try{var o,s,n
;return t instanceof Array||e instanceof Array?(n=t.join(String.fromCharCode(0)),s=e.join(String.fromCharCode(0))):(n=t,s=e),null!=(o=0===t.length&&0===e.length?this.pivotData.allTotal[i]:0===t.length?this.pivotData.colTotals[s][i]:0===e.length?this.pivotData.rowTotals[n][i]:this.pivotData.tree[n][s])?o:{value:function(){return null},format:function(){return""}}}catch(t){a.w.printStackTrace(t)}},c.prototype.getRowIndexByKey=function(t){try{var e=t.join(String.fromCharCode(0));for(var i in this.pivotData.rowKeys)if(this.pivotData.rowKeys[i].join(String.fromCharCode(0))==e)return parseInt(i)}catch(t){a.w.printStackTrace(t)}},c.prototype.getColIndexByKey=function(t){try{var e=t.join(String.fromCharCode(0));for(var i in this.pivotData.colKeys)if(this.pivotData.colKeys[i].join(String.fromCharCode(0))==e)return parseInt(i)}catch(t){a.w.printStackTrace(t)}};var p=function(){};p.prototype.getValue=function(t,e){try{return this._getAggregator(t,e).value()}catch(t){a.w.printStackTrace(t)}},p.prototype.getFormattedValue=function(t,e){try{var i=this._getAggregator(t,e);return"number"==this.options.valueDataType?i.format(i.value()):i.value()}catch(t){a.w.printStackTrace(t)}},p.prototype.setValue=function(t,e,i,o){try{var s=this._getAggregator(t,e).value();if(i!==s){var n=this.pivotData.rowKeys[t],l=this.pivotData.colKeys[e],r=n.join(String.fromCharCode(0)),h=l.join(String.fromCharCode(0));if(this.mappingDataInfoByKey[r][h]){var d=this.mappingDataInfoByKey[r][h].mappedRowIndex,c=this.mappingDataInfoByKey[r][h].mappedColID;return this._dataList.setCellData(d,c,i),this.data[d][c]=i,{rowIndex:d,colID:c,value:s}}}}catch(t){a.w.printStackTrace(t)}},p.prototype.getDataListRowIndex=function(t,e){try{var i=this.pivotData.rowKeys[t],o=this.pivotData.colKeys[e],s=i.join(String.fromCharCode(0)),n=o.join(String.fromCharCode(0));return this.pivotData.mappingDataInfoByKey[s][n]?this.pivotData.mappingDataInfoByKey[s][n].mappedRowIndex:null}catch(t){a.w.printStackTrace(t)}},p.prototype.getFusionChartData=function(t){try{var e={};this.pivotDataArr;switch(this._multiSerises=function(){(e=this._getFusionChartCategory()).dataset=[];for(var t=0;t<this.pivotData.rowKeys.length;t++){var i=this._getFusionChartSeriesDate(t);i.data.length>0&&e.dataset.push(i)}return e},this._getFusionChartCategory=function(){for(var t=[],e=[],i=0;i<this.pivotData.colKeys.length;i++)e.push(this.pivotData.colKeys[i].join(this.options.chartDataSeperator));for(i=0;i<e.length;i++){var o={label:e[i]};t.push(o)}return{categories:[{category:t}]}},this._getFusionChartSeriesDate=function(t,e){var i,o={};o.data=[];i=this.pivotData.rowKeys[t].join(this.options.chartLegendSeperator),o.seriesname=i;for(var s={},a=0;a<this.pivotData.colKeys.length;a++)s={value:this.pivotDataArr[t*this.pivotData.colKeys.length+a]},o.data.push(s);return o},t.toLowerCase()){case"mscolumn2d":case"mscolumn3d":case"msline":case"msarea":case"msbar2d":case"msbar3d":case"marimekko":case"stackedcolumn2d":case"stackedcolumn3d":case"stackedarea2d":case"stackedarea2dlinedy":case"stackedbar2d":case"stackedbar3d":case"mscombi3d":case"mscombi2d":case"mscolumnline3d":case"stackedcolumn2dline":case"stackedcolumn2dlinedy":case"stackedcolumn3dline":case"mscombidy2d":case"mscombidy3d":case"mscolumn3dlinedy":case"scrollcolumn2d":case"scrollline2d":case"scrollArea2d":case"scrollbar2d":case"scrollstackedcolumn2d":case"scrollstackedbar2d":case"scrollcombi2d":case"scrollcombidy2d":case"stackedcolumn3dlinedy":return this._multiSerises()}}catch(t){a.w.printStackTrace(t)}};var u=function(){};u.prototype.setFocus=function(t,e){try{var i=n.B.getTarget(t)||t.element;if("TD"==i.tagName){e=e||{};var o=t.ctrlKey,s=e.shiftKey||t.shiftKey,r=i.getAttribute("data-coordinate").split(","),h=r[0]-0,d=r[1]-0,c=this.getLastFocusedCell();this.focusedCell.length>0&&c.focusedTd==i&&!1;for(var p=0,u=0,v=this.colIndex;v<this.colWidthInfo.length;v++)u+=this.colWidthInfo[v],this.viewTotalCellWidth>u&&p++
;if(this.options.useCtrlKey&&o||l.D.getBoolean(this.options.useShiftKey)&&s||(this.applyFocusedCellOut(),this.focusedCell=[]),this.focusedCell.length>0&&l.D.getBoolean(this.options.useShiftKey)&&s){var f=this.focusedCell[0],g=f.focusedRowIndex,m=f.focusedColIndex,y=g>h,w=m>d;this.applyFocusedCellOut(),this.focusedCell=[];for(v=g;y?v>=h:v<=h;y?v--:v++)for(var C=m;w?C>=d:C<=d;w?C--:C++)if(!(v-this.rowIndex>=this.viewedRowNum||C-this.colIndex>=p)){var x=this.pivotDOM.tdMap[v-this.rowIndex][C-this.colIndex];if(v<this.rowIndex&&(x=null),this.focusedCell.push({focusedTd:x,focusedRowIndex:v,focusedColIndex:C}),null!=x){var b=!0;C==d&&v==h&&(b=!1),this.applyFocusedCellIn(x,b)}}c=this.getLastFocusedCell()}else{if(this.options.blockSelect)return;if(h-this.rowIndex>=this.viewedRowNum||d-this.colIndex>=p)return;if(this.focusedCell.push({focusedTd:i,focusedRowIndex:h,focusedColIndex:d}),this.applyFocusedCellIn(i,!!e.editMode),c=this.getLastFocusedCell(),"cell"==this.options.focusMode){for(v=this.focusedCell.length-2;v>=0;v--)if(this.focusedCell[v].focusedTd==c.focusedTd){this._applyFocusedCellOut(this.focusedCell[v]),this.focusedCell.pop(),this.focusedCell.splice(v,1);break}}else if("both"==this.options.focusMode){for(v=this.focusedCell.length-2;v>=0;v--)if(this.focusedCell[v].focusedTd==c.focusedTd){this._applyFocusedCellOut(this.focusedCell[v]),this.focusedCell.pop(),this.focusedCell.splice(v,1),this.changeFocusedCellPosition(this.rowIndex);break}}else if("row"==this.options.focusMode){var T=c.focusedTd?c.focusedTd.parentNode:null;for(v=this.focusedCell.length-2;v>=0;v--){var I=this.focusedCell[v];if(null!=I.focusedTd){for(var D=I.focusedTd.parentNode,A=parseInt(D.getAttribute("trIndex"));A>0;)A--,D=l.D.prev(D);do{if(D==T){this._applyFocusedCellOut(this.focusedCell[v]),this.focusedCell.pop(),this.focusedCell.splice(v,1),this.changeFocusedCellPosition(this.rowIndex);break}D=l.D.next(D)}while("0"!=D.getAttribute("trIndex"))}}}}this.editingTD&&this.endCellEditMode()}}catch(t){a.w.printStackTrace(t)}},u.prototype.removeFocus=function(t){try{WebSquare.style.removeClass(t,"w2editablePivot_focusedCell"),t.blur()}catch(t){a.w.printStackTrace(t)}},u.prototype.getLastFocusedCell=function(){try{if(this.focusedCell.length>0)return this.focusedCell[this.focusedCell.length-1];var t={focusedRowIndex:-1,focusedColIndex:null};return t}catch(t){a.w.printStackTrace(t)}},u.prototype.applyFocusedCellOut=function(){try{if(this.focusedCell.length>0)for(var t=0;t<this.focusedCell.length;t++){var e=this.focusedCell[t];this._applyFocusedCellOut(e)}}catch(t){a.w.printStackTrace(t)}},u.prototype._applyFocusedCellOut=function(t){try{if("cell"!=this.options.focusMode&&"both"!=this.options.focusMode||null!=t.focusedTd&&("linear"!=this.options.focusFlow&&t.focusedTd.setAttribute("tabIndex",-1),this.removeFocus(t.focusedTd)),null!=t.focusedTd){var e=this.getCoordinate(t.focusedTd).colIndex;this.pivotData.colKeys.length-1==e&&(this.adjustTableWidth=!1)}}catch(t){a.w.printStackTrace(t)}},u.prototype.applyFocusedCellIn=function(t,e){try{if("none"==this.options.focusMode)return;this.focusedByApi=!0;var i=this.focusedCell[this.focusedCell.length-1].focusedRowIndex,o=!1;this.rowIndex>0&&this.options.fixedRow>0&&i>=0&&this.options.fixedRow>i&&(o=!0),t.setAttribute("tabIndex",0);e||o||(l.D.isIE(8)?"none"!=t.parentElement.style.display&&t.focus():t.focus()),"cell"!=this.options.focusMode&&"both"!=this.options.focusMode||this.addClass(t,"w2editablePivot_focusedCell");var s=this.getCoordinate(t).colIndex;this.pivotData.colKeys.length-1==s&&(this.adjustTableWidth=!0,t.style.width=parseInt(t.style.width)-3+"px")}catch(t){a.w.printStackTrace(t)}},u.prototype.changeFocusedCellPosition=function(t,e,i){if(0!=this.focusedCell.length){this.applyFocusedCellOut();for(var o=0,s=0,a=e;a<this.colWidthInfo.length;a++)s+=this.colWidthInfo[a],this.viewTotalCellWidth>s&&o++;for(a=0;a<this.focusedCell.length;a++){
var n=parseInt(this.focusedCell[a].focusedRowIndex)-t,l=parseInt(this.focusedCell[a].focusedColIndex)-e,r=!0;this.options.fixedRow>0&&this.options.fixedColumn>0?this.options.fixedRow>this.focusedCell[a].focusedRowIndex&&this.options.fixedColumn>this.focusedCell[a].focusedColIndex?(n=this.focusedCell[a].focusedRowIndex,l=this.focusedCell[a].focusedColIndex):this.options.fixedRow>this.focusedCell[a].focusedRowIndex?(n=this.focusedCell[a].focusedRowIndex,l<this.options.fixedColumn&&(r=!1)):this.options.fixedColumn>this.focusedCell[a].focusedColIndex?(l=this.focusedCell[a].focusedColIndex,n<this.options.fixedRow&&(r=!1)):(n<this.options.fixedRow&&(r=!1),l<this.options.fixedColumn&&(r=!1)):this.options.fixedRow>0?this.options.fixedRow>this.focusedCell[a].focusedRowIndex?n=this.focusedCell[a].focusedRowIndex:n<this.options.fixedRow&&(r=!1):this.options.fixedColumn>0&&(this.options.fixedColumn>this.focusedCell[a].focusedColIndex?l=this.focusedCell[a].focusedColIndex:l<this.options.fixedColumn&&(r=!1));var h=null;if(n<0||n>this.maxRowLength)h=null;else if(1==r&&(this.pivotDOM.tdMap[n]&&(h=this.pivotDOM.tdMap[n][l]),h)){for(var d=0,c=0,p=0;p<l;p++)d+=this.pivotDOM.tdMap[n][p].offsetWidth;for(var u=0;u<n;u++)c+=this.pivotDOM.tdMap[u][0].offsetHeight;d<this.viewTotalCellWidth&&c<this.viewTotalCellHeight&&this.viewTotalCellHeight-c>=this.cellHeight&&l<o&&this.applyFocusedCellIn(h,i)}this.focusedCell[a].focusedTd=h}}},u.prototype.getFocusedRowIndex=function(){return this.getLastFocusedCell().focusedRowIndex},u.prototype.getFocusedColumnIndex=function(){return this.getLastFocusedCell().focusedColIndex},u.prototype.setFocusedCell=function(t,e,i){try{if("none"==this.options.focusMode)return;if(0==arguments.length||1==arguments.length){i=0!=arguments.length&&arguments[0];if(this.focusedCell.length>0)t=this.focusedCell[this.focusedCell.length-1].focusedRowIndex,e=this.focusedCell[this.focusedCell.length-1].focusedColIndex;else if(this.lastFocusedCell&&null!=this.lastFocusedCell.focusedColIndex&&this.lastFocusedCell.focusedRowIndex>=0)t=this.lastFocusedCell.focusedRowIndex,e=this.lastFocusedCell.focusedColIndex}i=l.D.getBoolean(i);var o=this.getPivotCellDomWhere(t,e);o&&this.setFocus({ctrl:!1,element:o},{editMode:i})}catch(t){a.w.printStackTrace(t,null,this)}},u.prototype._applyHeaderFocusedCellIn=function(t,e,i){try{var o,s,n=n,r=l.D.getDataPrefix("header-data");if(this.options.headerListMouseOver)s=this.options.headerListMouseOverColor;else if(!(s=i||this.options.headerBackgroundColor))return;if(e&&e!=this.options.grandTotalName)o=e;else for(var h=0;h<this.columnInfoList.length;h++)this.columnInfoList[h].name==t&&(o=this.columnInfoList[h].id);for(var d=0;d<this.pivotData.colAttrs.length;d++)if(this.pivotData.colAttrs[d]==o){d,n="col";break}for(var c=0;c<this.pivotData.rowAttrs.length;c++)if(this.pivotData.rowAttrs[c]==o){c,n="row";break}if(n||(this.pivotData.colAttrs[0]==this.options.grandTotalName?(o=this.options.grandTotalName,n="colValue"):this.pivotData.rowAttrs[0]==this.options.grandTotalName?(o=this.options.grandTotalName,n="rowValue"):this.pivotData.rowAttrs[this.pivotData.rowAttrs.length-1]==this.options.grandTotalName?(o=this.options.grandTotalName,n="row"):this.pivotData.colAttrs[this.pivotData.colAttrs.length-1]==this.options.grandTotalName&&(o=this.options.grandTotalName,n="col")),"col"==n){this.colOverAttrName=o;var p,u=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_header_TR"),v=this.pivotData.colAttrs.indexOf(o);for(h=0;h<this.pivotData.colAttrs.length;h++){u[h].getElementsByClassName("pvtAxisLabel")[0].style.backgroundColor=h==v?s:"",p=u[h].getElementsByClassName("pvtColLabel");for(d=0;d<p.length;d++)p[d].style.backgroundColor=h==v?s:""}}else if("row"==n){this.rowOverAttrName=o;u=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_header_TR")
;var f=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_content_TR"),g=u[x=this.pivotData.colAttrs[0]==this.options.grandTotalName?0:this.pivotData.colAttrs.length]?u[x].getElementsByClassName("pvtAxisLabel"):void 0;for(v=this.pivotData.rowAttrs.indexOf(o),c=0;c<g.length;c++){"row"==(b=g[c].getAttribute("data-axis").split(":"))[0]&&b[1]==v?g[c].style.backgroundColor=s:g[c].style.backgroundColor=""}for(h=0;h<f.length;h++){var m=f[h].getElementsByClassName("pvtRowLabel"),y=x?void 0:f[h].getElementsByClassName("pvtAxisLabel"),w=this.pivotData.rowAttrs.length;for(d=0;d<w;d++)m[d]&&(m[d].getAttribute(r)?b=m[d].getAttribute(r).split(":"):m[d].getAttribute("data-axis")&&(b=m[d].getAttribute("data-axis").split(":")),"row"==b[0]&&b[1]==v?m[d].style.backgroundColor=s:m[d].style.backgroundColor="");y&&y.length>0&&((b=y[0].getAttribute("data-axis").split(":"))[1]==v?y[0].style.backgroundColor=s:y[0].style.backgroundColor="")}}else if("colValue"==n){this.colValueOver=!0,C=(u=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_header_TR"))[0].getElementsByClassName("pvtAxisLabel");for(h=0;h<C.length;h++)"col"==(b=C[h].getAttribute("data-axis").split(":"))[0]?C[h].style.backgroundColor=s:C[h].style.backgroundColor=""}else if("rowValue"==n){this.rowValueOver=!0;var C;for(u=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_content_TR"),h=0;h<u.length;h++)"col"==(b=(C=u[h].getElementsByClassName("pvtAxisLabel"))[0].getAttribute("data-axis").split(":"))[0]?C[0].style.backgroundColor=s:C[0].style.backgroundColor=""}else if("rowValues"==n){this.rowValuesOver=!0;var x;for(u=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_header_TR"),f=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_content_TR"),g=u[x=this.pivotData.colAttrs[0]==this.options.grandTotalName?0:this.pivotData.colAttrs.length].getElementsByClassName("pvtAxisLabel"),v=this.pivotData.rowAttrs.indexOf(this.options.grandTotalName),c=0;c<g.length;c++){g[c].getAttribute(r)?b=g[c].getAttribute(r).split(":"):g[d].getAttribute("data-axis")&&(b=g[c].getAttribute("data-axis").split(":")),"row"==b[0]&&b[1]==v?g[c].style.backgroundColor=s:g[c].style.backgroundColor=""}for(h=0;h<f.length;h++){var b;for(m=f[h].getElementsByClassName("pvtRowLabel"),y=x?void 0:f[h].getElementsByClassName("pvtAxisLabel"),w=this.pivotData.rowAttrs.length,d=0;d<w;d++)m[d]&&(m[d].getAttribute(r)?b=m[d].getAttribute(r).split(":"):m[d].getAttribute("data-axis")&&(b=m[d].getAttribute("data-axis").split(":")),"row"==b[0]&&b[1]==v?m[d].style.backgroundColor=s:m[d].style.backgroundColor="")}}}catch(t){a.w.printStackTrace(t)}},u.prototype._applyHeaderFocusedCellOut=function(t){try{if(this.colOverAttrName){var e,i=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_header_TR");(v=this.pivotData.colAttrs.indexOf(this.colOverAttrName))>=0&&(e=i[v].getElementsByClassName("pvtColLabel"),i[v].getElementsByClassName("pvtAxisLabel")[0].style.backgroundColor="");for(var o=0;o<e.length;o++)e[o].style.backgroundColor="";this.colOverAttrName=""}else if(this.rowOverAttrName){i=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_header_TR");for(var s=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_content_TR"),n=i[u=this.pivotData.colAttrs[0]==this.options.grandTotalName?0:this.pivotData.colAttrs.length]?i[u].getElementsByClassName("pvtAxisLabel"):[],l=0;l<n.length;l++)n[l].style.backgroundColor="";for(o=0;o<s.length;o++){for(var r=s[o].getElementsByClassName("pvtRowLabel"),h=u?void 0:s[o].getElementsByClassName("pvtAxisLabel"),d=this.pivotData.rowAttrs.length,c=0;c<d;c++)r[c]&&(r[c].style.backgroundColor="");h&&h.length>0&&(h[0].style.backgroundColor="")}this.rowOverAttrName=""}else if(this.colValueOver){this.colValueOver=!1
;var p=(i=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_header_TR"))[0].getElementsByClassName("pvtAxisLabel");for(o=0;o<p.length;o++)p[o].style.backgroundColor=""}else if(this.rowValueOver){this.rowValueOver=!1;for(i=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_content_TR"),o=0;o<i.length;o++)(p=i[o].getElementsByClassName("pvtAxisLabel"))[0].style.backgroundColor=""}else if(this.rowValuesOver){this.rowsValueOver=!1;i=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_header_TR"),s=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_content_TR"),n=i[u=this.pivotData.colAttrs[0]==this.options.grandTotalName?0:this.pivotData.colAttrs.length].getElementsByClassName("pvtAxisLabel");var u,v=this.pivotData.rowAttrs.indexOf(this.options.grandTotalName);for(l=0;l<n.length;l++)n[l].style.backgroundColor="";for(o=0;o<s.length;o++)for(r=s[o].getElementsByClassName("pvtRowLabel"),h=u?void 0:s[o].getElementsByClassName("pvtAxisLabel"),d=this.pivotData.rowAttrs.length,c=0;c<d;c++)r[c]&&(r[c].style.backgroundColor="")}this.pivotOverAttrName=null}catch(t){a.w.printStackTrace(t)}};var v=function(){};v.prototype.initializeEvent=function(){try{this.otherClickEvent(),this.event.addListener(this.render,"onmousewheel",this.event.bindAsEventListener(this,this.handleRenderWheel)),1!=this.options.noColumnMove&&this.event.addListener(this.render,"onmousedown",this.event.bindAsEventListener(this,this.handleDragEvent)),this.event.addListener(this.render,"onclick",this.event.bindAsEventListener(this,this.handleRenderClick)),this.event.addListener(this.render,"oncontextmenu",this.event.bindAsEventListener(this,this.handleRenderRightClick)),this.event.addListener(this.render,"ondblclick",this.event.bindAsEventListener(this,this.handleRenderDoubleClick)),this.event.addListener(this.render,"onkeydown",this.event.bindAsEventListener(this,this.handleRenderKeyDown)),this.event.addListener(this.render,"onmousemove",this.event.bindAsEventListener(this,this.handleColumnResize)),this.event.addListener(this.render,"onmouseover",this.event.bindAsEventListener(this,this.pivotOver)),this.event.addListener(this.render,"onmouseout",this.event.bindAsEventListener(this,this.pivotOut)),this.event.addListener(this.render,"onmousedown",this.event.bindAsEventListener(this,this.doColumnResize)),this.event.addListener(document.documentElement,"onmouseup",this.event.bindAsEventListener(this,this.endColumnResize)),l.D.isTouchDevice()&&(this.event.addListener(this.render,"ontouchstart",this.event.bindAsEventListener(this,this.touchHandler)),this.event.addListener(this.render,"ontouchmove",this.event.bindAsEventListener(this,this.touchHandler)),this.event.addListener(this.render,"ontouchend",this.event.bindAsEventListener(this,this.touchHandler)),this.event.addListener(this.render,"ontouchcancel",this.event.bindAsEventListener(this,this.touchHandler))),l.D.isIEAllVersion()?l.D.isIEAllVersion()&&(this.event.addListener(this.render,"oncopy",this.event.bindAsEventListener(this,(function(t){this.options.preventCopy||n.B.preventDefault(t)}))),this.event.addListener(this.render,"onpaste",this.event.bindAsEventListener(this,(function(t){n.B.preventDefault(t)})))):s.v.browserCheck.safari?(this.event.addListener(WebSquare.getBody().render,"onbeforecopy",this.event.bindAsEventListener(this,this.handleBeforeCopyEvent)),this.event.addListener(WebSquare.getBody().render,"oncopy",this.event.bindAsEventListener(this,this.handleCopyEvent)),this.event.addListener(this.render,"onpaste",this.event.bindAsEventListener(this,this.handlePasteEvent))):(s.v.browserCheck.chrome||this.event.addListener(this.render,"oncopy",this.event.bindAsEventListener(this,this.handleCopyEvent)),this.event.addListener(this.render,"onpaste",this.event.bindAsEventListener(this,this.handlePasteEvent)))}catch(t){a.w.printStackTrace(t)}},v.prototype.handleDragEvent=function(t){try{
for(var e=this.event.getTargetIterator(t);e.next();){if(e.match("type1")||e.match("type5")){this.addClass("w2noselect"),l.D.emptySelection();var i=e.getElement(),o=i.innerHTML;i.style.cursor="pointer";var s=i.getAttribute("data-axis").split(":"),r=this;return void WebSquare.dragdrop.gDragManager.activate(t,i,{id:this.id+"_drag",className:"w2editablePivot_drag",contents:o,delay:15,detachedAttr:o,applyMousePosition:!0,onDrop:function(t,e,i,o,a,n,l){for(var h=r.event.getTargetIterator(l);h.next();){if(h.match("type1")||h.match("type5")){var d=h.getElement().getAttribute("data-axis").split(":");r.movePivotAxis(s,d,!1);break}if(h.match("w2editablePivot_container_header_hiddenList")){r.movePivotHiddenList(s);break}if(h.match("type7")){var c=r.pivotData.rowAttrs;/*!destElem.getAttribute("data-axis") && */1==c.length&&c[0]==r.options.grandTotalName&&(r.pivotData.rowAttrs=[],d=["row",0,""],r.movePivotAxis(s,d,!0));break}if(h.match("type2")){var p=r.pivotData.colAttrs;/*!destElem.getAttribute("data-axis") && */1==p.length&&p[0]==r.options.grandTotalName&&(r.pivotData.colAttrs=[],d=["col",0,""],r.movePivotAxis(s,d,!0));break}if(h.match(null,null,"body"))break}r.removeClass("w2noselect")}})}if(e.match("type8")){r=this;return WebSquare.dragdrop.gDragManager.activate(t,this.render,{id:this.id+"_dragSelect",delay:15,handleStart:function(t){r.setFocus(t)},handleUpdate:function(t,e,i,o,s){for(var a=null,n=null,l=r.event.getTargetIterator(s);l.next();){if(l.match("w2editablePivot")){a=l.getElement().id;break}l.match("type8")&&(n=null,n=l.getElement())}null!=a&&null!=n&&r.id==a&&r.setFocus(s,{shiftKey:!0})}}),void(l.D.isIEAllVersion()&&(l.D.emptySelection(),n.B.preventDefault(t)))}}}catch(t){a.w.printStackTrace(t)}},v.prototype.handleRenderRightClick=function(t){try{n.B.preventDefault(t);for(var e=this.event.getTargetIterator(t,this.render);e.next();)if(e.match("type8")){var i=e.getElement().getAttribute("data-coordinate").split(","),o={e:t,rowIndex:i[0],colIndex:i[1],value:this.getValue(i[0],i[1]),affix:""};this.handleCellClick(t),t.ctrlKey||t.metaKey||this.options.contextMenuGetter&&0==this.isEditting&&this.showContextMenu(o)}}catch(t){a.w.printStackTrace(t)}},v.prototype.handleRenderClick=function(t){try{if(this.lastEvent=t,n.B.fireEvent(this,"onclick",t),this.isMobile&&this.iScroll&&this.iScroll.moveDirection)return;this.contextMenu&&this.hideContextMenu();for(var e=this.event.getTargetIterator(t,this.render);e.next();)if(e.match("type1"));else if(e.match("type2"));else if(e.match("type3"));else if(e.match("type4"));else if(e.match("type5"));else if(e.match("type6"));else if(e.match("type7"));else{if(e.match("type8")){this.handleCellClick(t);break}e.match("type9")||e.match("type10")||e.match("type11")||e.match("type12")||e.match("type13")||e.match("type14")||e.match("type15")||e.match("type16")||(e.match("w2editablePivot_container_content")||e.match("w2editablePivot_container_header")||e.match("w2editablePivot_container_showedValueList")||e.match("w2editablePivot_container_hiddenValueList"))&&this.editingTD&&this.endCellEditMode()}}catch(t){a.w.printStackTrace(t)}},v.prototype.handleRenderDoubleClick=function(t){try{for(var e=this.event.getTargetIterator(t,this.render);e.next();)if(e.match("type1"));else if(e.match("type2"));else if(e.match("type3"));else if(e.match("type4"));else if(e.match("type5"));else if(e.match("type6"));else if(e.match("type7"));else{if(e.match("type8")&&!e.match("w2editablePivot_cellDisabled")){this.handleCellDblClick(t);break}e.match("type9")||e.match("type10")||e.match("type11")||e.match("type12")||e.match("type13")||e.match("type14")||e.match("type15")||e.match("type16")||e.match("w2editablePivot")||(e.match("w2editablePivot_container_content")||e.match("w2editablePivot_container_header")||e.match("w2editablePivot_container_showedValueList")||e.match("w2editablePivot_container_hiddenValueList"))&&this.editingTD&&this.endCellEditMode()}}catch(t){a.w.printStackTrace(t)}},v.prototype.handleCellDblClick=function(t){
try{if(this.contextMenu&&this.hideContextMenu(),"true"==this.options.editablePivotMode){var e=n.B.getTarget(t);if(e.className.indexOf("type8")>0){for(var i=e.getAttribute("data-coordinate").split(","),o=i[0]-0,s=i[1]-0,l=0,r=0,h=this.colIndex;h<this.colWidthInfo.length;h++)r+=this.colWidthInfo[h],this.viewTotalCellWidth>r&&l++;o-this.rowIndex<this.viewedRowNum&&s-this.colIndex<l&&this.setCellEditMode(e)}}}catch(t){a.w.printStackTrace(t)}},v.prototype.handleRenderKeyDown=function(t){try{this.contextMenu&&this.hideContextMenu(),this.handleBodyKeyDown(t)}catch(t){a.w.printStackTrace(t)}},v.prototype.handleScrollX=function(t){try{if(1==this.settingColumnWidth)return void(this.settingColumnWidth=!1);if(this.contextMenu&&this.hideContextMenu(),this.scrollEvent){this.scrollX.isTheEndOfTheScrollX=!1;var e=this.scrollX.scrollX_AREA,i=Math.floor(e.scrollLeft),o=Math.floor(e.scrollWidth-e.offsetWidth),s=0;this.options.showGrandTotal&&"horizontal"!=this.options.grandTotalDisplayType&&(s=1,"col"==this.pivotData.valuesAxis&&(s=this.pivotData.valAttrs.length));var n=0;this.scrollX.startColIndex=0;for(var l=0,r=0,h=this.pivotData.colKeys.length-1+s,d=0;h>0;h--,d++){if(l+=this.colWidthInfo[h],!(this.viewTotalCellWidth>l)){l-=this.colWidthInfo[h];break}r=h}if(this.maxStartColIndex=r,0!=e.scrollWidth&&Math.abs(o-i)<3)this.scrollX.startColIndex=r;else{var c=i/o,p=this.totalDataCellWidth-l+this.viewTotalCellWidth;for(h=0;h<this.pivotData.colKeys.length+s;h++){if(!(c>=(n+=this.getColumnWidth(h))/p)){this.viewTotalCellWidth<this.getColumnWidth(h)&&(this.scrollX.startColIndex=h);break}this.scrollX.startColIndex=h}}r<this.scrollX.startColIndex&&(this.scrollX.startColIndex=r),this.drawPivotTable()}this.scrollEvent=!0}catch(t){a.w.printStackTrace(t)}},v.prototype.handleScrollY=function(t){try{if(this.contextMenu&&this.hideContextMenu(),this.scrollEvent){this.scrollY.isTheEndOfTheScrollY=!1;var e=this.scrollY.scrollY_AREA,i=Math.floor(e.scrollTop);this.scrollY.startRowIndex=Math.ceil(i/this.cellHeight);var o=0;this.options.showGrandTotal&&"vertical"!=this.options.grandTotalDisplayType&&(o=1,"row"==this.pivotData.valuesAxis&&(o=this.pivotData.valAttrs.length));for(var s=0,n=0,l=this.pivotData.rowKeys.length-1+o,r=0;l>0&&(n+=this.cellHeight,this.viewTotalCellHeight>n);l--,r++)s=l;s<this.scrollY.startRowIndex&&(this.scrollY.startRowIndex=s),this.maxStartRowIndex=s;var h=Math.floor(e.scrollHeight)-Math.floor(e.offsetHeight);h>0&&(h==i||Math.abs(h-i)<=3)&&(this.scrollY.startRowIndex++,this.adjustScrollY),this.drawPivotTable()}this.scrollEvent=!0}catch(t){a.w.printStackTrace(t)}},v.prototype.handleRenderWheel=function(t){try{this.contextMenu&&this.hideContextMenu();var e=document.getElementById(this.id+"_container_scrollX"),i=document.getElementById(this.id+"_container_scrollY"),o=t.detail,s=t.wheelDelta,r=t.wheelDeltaY,h=t.wheelDeltaX,d=3,c=0,p=-1!=navigator.userAgent.indexOf("Windows")||!1,u=-1!=navigator.userAgent.indexOf("Macintosh")||!1;if(l.D.isChrome()?(c=s<0?-1*s:s,(p||u)&&(d*=c/120)):l.D.isSafari()?(c=s<0?-1*s:s,p?d*=c/120:u&&(d*=c/12)):l.D.isFF()?(c=o<0?-1*o:o,p?d*=c/3:u&&(d*=c)):l.D.isOpera()?(c=s<0?-1*s:s,p?d*=c/120:u&&(d*=c/160)):l.D.isIEAllVersion("8 9 10 11")&&(d*=(c=s<0?-1*s:s)/120),d=Math.floor(d),e&&"wheelDeltaX"in t&&Math.abs(h)>Math.abs(r))return e.scrollLeft-=h,void n.B.stopEvent(t);if(i){if(this.scrollEvent=!0,s>0||o<0){if(0==i.scrollTop)return void(this.options.wheelStop&&n.B.stopEvent(t));i.scrollTop-=120}else if(s<0||o>0){if(this.rowIndex<0||0==i.clientHeight||i.scrollTop==i.scrollHeight-i.clientHeight)return void(this.options.wheelStop&&n.B.stopEvent(t));i.scrollTop+=120}n.B.stopEvent(t)}}catch(t){a.w.printStackTrace(t)}},v.prototype.handleCellClick=function(t){try{if(this.setFocus(t),"true"!=this.options.editablePivotMode){var e=n.B.getTarget(t)||t.element;if("TD"==e.tagName){var i=e.getAttribute("data-coordinate").split(","),o=i[0]-0,s=i[1]-0,l=this.pivotData.colKeys.length,r={rowIndex:o,colIndex:s,
rowData:this.pivotDataArr.slice(o*l,o*l+l)};n.B.fireEvent(this,"oncellclick",r)}}}catch(t){a.w.printStackTrace(t)}},v.prototype.handlePasteEvent=function(t){try{if(this.options.preventPaste)return;var e=(l.D.isIEAllVersion()?window.clipboardData:t.clipboardData).getData("Text");"\r\n"==e.slice(-2)?e=e.slice(0,e.length-2):"\n"==e.slice(-1)&&(e=e.slice(0,e.length-1));var i=Papa.parse(e,{delimiter:"\t"}).data;if(!i||null==i||"undefined"==i)return;if(this.focusedCell.length>0){for(var o=this.pivotData.rowKeys.length,r=0,h=this.pivotData.colKeys.length,d=0,c=null,p=0;p<this.focusedCell.length;p++){var u=this.focusedCell[p],v=u.focusedRowIndex,f=u.focusedColIndex;o>v&&(o=v),r<v&&(r=v),h>f&&(h=f),d<f&&(d=f)}var g=0;for(p=this.defaultColCnt+h;p<d;p++)1==this.hiddenList[p]&&(g+=1);if(this.focusedCell.length!=(r-o+1)*(d-h-g+1))return;for(p=0;p<this.focusedCell.length;p++)if(u=this.focusedCell[p],v=u.focusedRowIndex,f=u.focusedColIndex,v==o&&f==h){c=u;break}if(null!=c.focusedTd){var m=c.focusedTd.getAttribute("data-coordinate").split(","),y=(v=m[0]-0,f=m[1]-0),w=this.pivotData.rowKeys.length,C=this.pivotData.colKeys.length;if(this.options.checkBlankRowOnPaste)for(p=i.length-1;p>-1;p--){for(var x=!0,b=0;b<i[0].length;b++)if(""!=i[p][b].wq_trim()){x=!1;break}x&&i.splice(p,1)}if(!1===n.B.fireEvent(this,"onbeforepaste",{rowIndex:v,colIndex:f,data:i.slice(0)}))return;var T=this,I=function(){var t,e,o=[],s=T.options.refreshLimit||100,a=T._dataList.getBroadcast()&&i.length>0&&i.length*i[0].length>s;!0===a&&T._dataList.setBroadcast(!1);for(var l=0;l<i.length;l++){var r=y;if(v+l>=w)break;for(var h=0;h<i[0].length&&!(null==r||r>=C);h++)if(T.options.checkReadOnlyOnPaste&&T.getReadOnly("all",l+v,r))r+=1;else if(T.options.checkDisabledOnPaste&&T.getDisabled("all",l+v,r))r+=1;else{var d,c=r,p=T.getValue(l+v,c),u=i[l][h];if(0==l&&0==h&&(t=v,e=c),T.userSetValueFunction){var f={rowIndex:l+v,colIndex:c,value:u};d=T.userSetValueFunction(f)}else{if("number"==T.options.valueDataType){u=u.wq_trim();if(u=/^-?\d*\.?\d+$/.exec(u),isNaN(parseFloat(u))){r+=1;continue}u="bigDecimal"==T.options.numberDataType?WebSquare.bigDecimal(u).toFixed():parseFloat(u)+""}d=T.setValue(l+v,c,u),p!=u&&n.B.fireEvent(T,"onviewchange",{oldValue:p,newValue:u,rowIndex:l+v,colIndex:c})}d&&o.push(d),r+=1}}T.options.undoRedo&&T._dataList.undoRedoSave(o),!0===a&&T._dataList.setBroadcast(!0,!0),null!=t&&null!=e&&T.setFocusedCell(t,e,!1)};if(this.options.showMessageOnPaste){var D=s.v.getConfiguration("/WebSquare/"+this.options.pluginName+"/pasteMessage/@value");WebSquare.layer.pasteMessageLoaded=!1,WebSquare.layer.showProcessMessage(D,{type:"pasteMsg",scope:this.scope_id||""});var A=function(){WebSquare.layer.pasteMessageLoaded?(l.D.clearTimeout(T.id+"_pasteMessageLoaded"),I(),WebSquare.layer.hideProcessMessage({type:"pasteMsg"}),n.B.fireEvent(T,"onafterpaste")):l.D.setTimeout(A,{delay:500,key:T.id+"_pasteMessageLoaded"})};A()}else I(),n.B.fireEvent(this,"onafterpaste")}}n.B.preventDefault(t)}catch(t){a.w.printStackTrace(t,null,this)}},v.prototype.handleBeforeCopyEvent=function(t){n.B.preventDefault(t)},v.prototype.handleCopyEvent=function(t){try{if(this.options.preventCopy)return;if(s.v.browserCheck.safari){for(var e=document.activeElement,i=!1;null!=e;)e.id&&e.id==this.id&&(i=!0),e=e.parentNode;if(!i)return}var o=l.D.isIEAllVersion()?window.clipboardData:t.clipboardData,r=this.options.copyAmount;if(r||(r="cell"),"cell"==r){for(var h=this.pivotData.rowKeys.length,d=0,c=this.pivotData.colKeys.length,p=0,u=[],v=0;v<this.focusedCell.length;v++){var f=this.focusedCell[v],g=f.focusedRowIndex,m=f.focusedColIndex;h>g&&(h=g),d<g&&(d=g),c>m&&(c=m),p<m&&(p=m)}if(this.focusedCell.length==(d-h+1)*(p-c-0+1))for(v=h;v<=d;v++){for(var y=[],w=c;w<=p;w++)if("display"==this.options.copyOption);else if(this.numberFormatter){var C={rowIndex:v,colIndex:w,value:this.getValue(v,w)};y.push(this.numberFormatter(C))}else y.push(this.getValue(v,w));u.push(y)}else{var x=this.focusedCell[this.focusedCell.length-1]
;if(null!=x){y=[];"display"==this.options.copyOption||y.push(this.getValue(x.focusedRowIndex,x.focusedColIndex)),u.push(y)}}var b=Papa.unparse(u,{delimiter:"\t"});o.setData("Text",b)}n.B.preventDefault(t)}catch(t){a.w.printStackTrace(t,null,this)}},v.prototype.otherClickEvent=function(){try{l.D.isTouchDevice&&this.event.addListener(document.documentElement,"ontouchstart",this.event.bindAsEventListener(this,this.handleClickEventDocument)),WebSquare.getBody().getLayerListener().addListener({component:this,event:{},otherClick:this.handleClickEventDocument,frameClick:this.handleClickEventFrame})}catch(t){a.w.printStackTrace(t,null,this)}},v.prototype.handleClickEventDocument=function(t){try{if(this.lastEvent=t,this.event.isMe(t,this.render)||this.isMine(t))this.handleClickEventDocumentAfter(t);else if(t.otherClick=!0,this.editingTD){this.handleClickEventDocumentAfter(t);var e=WebSquare.getBody();e.layerListener.handleMouseDownEventDocument.call(e,t),e=null,this.endCellEditMode()}else this.handleClickEventDocumentAfter(t)}catch(t){a.w.printStackTrace(t,null,this)}},v.prototype.handleClickEventDocumentAfter=function(t){try{this.contextMenu&&(t.srcElement.className.match("contextMenu")||this.hideContextMenu())}catch(t){a.w.printStackTrace(t,null,this)}},v.prototype.handleClickEventFrame=function(t){try{this.editingTD&&this.endCellEditMode(),this.hideContextMenu()}catch(t){a.w.printStackTrace(t)}},v.prototype.isMine=function(t){try{for(var e=n.B.getTarget(t);null!=e;){if(e.id&&e.id.indexOf&&e.id.indexOf("G_"+this.id+"__")>=0)return!0;e=e.parentNode}return!1}catch(t){a.w.printStackTrace(t)}},v.prototype.handleColumnResize=function(t){try{var e=document.getElementById(this.id+"_head_table");if(e){if(this.handleResizeLine(t),null!=this.columnMoveTarget)return;for(var i,o=this.event.getTargetIterator(t,this.render),s=null;o.next();){var l=o.getElement();if("TH"==l.tagName)if(s=l,o.match("pivotemptyrowheader"))i="emptyRow";else if(o.match("pivotemptycolheader"))i="emptyCol";else if(o.match("type5"))if(this.options.noColumnMove){var r=s.getAttribute("data-axis").split(":");0===(h=parseInt(r[1]))&&(i="type5")}else i="type5";else o.match("type1")&&(i="type1");if("NOBR"==l.tagName){s=null;break}}if(e.style.cursor="",e.cursor="",null==s)return;if(!1===this.options.noColumnMove&&i)return void("type5"!==i&&"type1"!==i||(s.style.cursor="pointer"));var h,d=n.B.getMouseX(t),c=WebSquare.style.getAbsoluteLeft(s),p=parseInt(s.getAttribute("colSpan")||1,10),u=s.getAttribute("data-coordinate");if(u)h=u.split(",")[1]-0;var v=c;if(d-v<10){if(i&&("emptyCol"===i||"type5"===i))return;if(0!=h)return e.style.cursor="col-resize",void(e.cursor="col-resize");if(this.options.noColumnMove&&0===h)return e.style.cursor="col-resize",void(e.cursor="col-resize")}for(var f=0;f<p;f++){var g=s.getBoundingClientRect().width;if((v+=parseInt(g))-10<d&&d<v+10)return e.style.cursor="col-resize",void(e.cursor="col-resize")}}}catch(t){a.w.printStackTrace(t,null,this)}},v.prototype.handleResizeLine=function(t){try{var e=document.getElementById(this.id+"_resize_line");if(e||((e=document.createElement("div")).setAttribute("id",this.id+"_resize_line"),e.style.cssText="display:none;position:absolute;top:10px; bottom:0px;border:0px dashed #222222; border-left-width:1px;",this.render.appendChild(e)),this.resize_ghost||(this.resize_ghost=document.createElement("div"),this.resize_ghost.className="w2grid_columnMove_ghost",this.resize_ghost.style.display="none",document.body.appendChild(this.resize_ghost),this.resize_arrow=document.createElement("div"),this.resize_arrow.className="w2grid_columnMove_arrow",this.resize_arrow.style.display="none",document.body.appendChild(this.resize_arrow)),this.resizeStarted){var i=document.getElementById(this.id+"_container_body");e.style.cssText="position:absolute;top:10px; bottom:0px;border:0px dashed #222222; border-left-width:1px;",e.style.display="block",e.style.zIndex=100,e.style.top=i.offsetTop+"px",e.style.height=i.offsetHeight+"px",
document.getElementById(this.id+"foot_table")&&(e.style.height=this.render.offsetHeight-document.getElementById(this.id+"_foot_table").offsetHeight-document.getElementById(this.id+"_scrollX_div").offsetHeight+"px"),e.style.left=n.B.getMouseX(t)-WebSquare.style.getAbsoluteLeft(this.render)+"px",this.resize_ghost.style.display="none"}else e.style.display="none",this.resize_ghost.style.display="none",this.resize_arrow.style.display="none"}catch(t){a.w.printStackTrace(t,null,this)}},v.prototype.doColumnResize=function(t){try{var e,i=this.event.getTargetIterator(t,this.render),o=null;for(this.resize_colIndex=null,this.reseizeAxisLabel_colIndex=null;i.next();)i.match("type2")&&(o=i.getElement(),e="type2"),this.options.noColumnMove&&(i.match("type1")&&(o=i.getElement(),e="type1"),i.match("type5")&&(o=i.getElement(),e="type5"),i.match("pivotemptyrowheader")&&(o=i.getElement(),e="emptyRow"),i.match("pivotemptycolheader")&&(o=i.getElement(),e="emptyCol"));if(null==o)return;if(this.startResizeX=n.B.getScreenX(t),"col-resize"==document.getElementById(this.id+"_head_table").cursor){n.B.preventDefault(t),this.resizeStarted=!0;var s,l=n.B.getMouseX(t),r=WebSquare.style.getAbsoluteLeft(o),h=parseInt(o.getAttribute("colSpan")||1,10),d=r;if("type2"===e)s=this.getCoordinate(o).colIndex;else if("type1"===e||"emptyRow"===e)this.reseizeAxisLabel_colIndex=l-d<10?this.pivotData.rowAttrs.length-1:this.pivotData.rowAttrs.length;else if("type5"===e){var c=o.getAttribute("data-axis").split(":"),p=parseInt(c[1]);if(l-d<10){if(0===p)return void(this.resizeStarted=!1);this.reseizeAxisLabel_colIndex=p-1}else this.reseizeAxisLabel_colIndex=p}else if("emptyCol"===e){if(l-d<10)return void(this.resizeStarted=!1);this.reseizeAxisLabel_colIndex=this.pivotData.rowAttrs.length-1}if(this.options.noColumnMove&&0==s&&l-d<10)this.reseizeAxisLabel_colIndex=this.pivotData.rowAttrs.length;else if(1<h){if(0==s&&l-d<10)return void(this.resizeStarted=!1);if(l-d>10)s=s+h-1;else{for(var u,v=this.findFirstSibling(o).getAttribute("data-axis").split(":"),f=this.calculateSpanSize("spanX",v[1],this.colIndex,this.colIndex),g=this.colIndex;g>=0;g--)if(this.spanInfo.spanX[g][v[1]]){u=this.spanInfo.spanX[g][v[1]];break}s-=u-f}}if("type2"===e&&null===this.reseizeAxisLabel_colIndex)if(this.resizeColIndex=s,l-d<10&&0!=s)this.resizeColIndex--;else for(g=0;g<h;g++){var m=o.getBoundingClientRect().width;if((d+=parseInt(m))-10<l&&l<d+10){this.resizeColIndex+=g;break}}}this.handleResizeLine(t)}catch(t){a.w.printStackTrace(t,null,this)}},v.prototype.findFirstSibling=function(t){try{return t.previousSibling&&t.previousSibling.className.indexOf("type1")>=0?t.previousSibling:this.findFirstSibling(t.previousSibling)}catch(t){a.w.printStackTrace(t,null,this)}},v.prototype.endColumnResize=function(t){try{if(this.resizeStarted){if(this.endResizeX=n.B.getScreenX(t),null!==this.reseizeAxisLabel_colIndex){var e=this.endResizeX-this.startResizeX;this._setAxisLabelColumnWidth(this.reseizeAxisLabel_colIndex,e)}else{var i=this.resizeColIndex||0;if(i>=0){var o=(this.colWidthInfo[i+this.colIndex]||this.options.defalutCellWidth)+this.endResizeX-this.startResizeX;(o=o<20?20:o)<this.viewTotalCellWidth&&this.setColumnWidth(i,o)}}this.resizeStarted=!1,this.columnMoveTarget=null,this.realColumnMoveTarget=null,this.handleResizeLine(t),document.getElementById(this.id+"_head_table").style.cursor="",l.D.emptySelection(),this.removeClass("w2noselect")}}catch(t){a.w.printStackTrace(t,null,this)}},v.prototype.pivotOver=function(t){var e,i=n.B.getTarget(t);if(1==this.options.headerListMouseOver){for(;i&&("SPAN"!=i.tagName||!this.hasClass(i,"pvtAttr"));)i=i.parentNode;i&&i.firstChild.data?(e=i.firstChild.data,this.pivotOverAttrName!=e&&i.parentNode.className.indexOf("valueItem")<0&&(this.pivotOverAttrName=e,this._applyHeaderFocusedCellIn(e))):this._applyHeaderFocusedCellOut()}},v.prototype.pivotOut=function(t){this.pivotOverAttrName&&(1==this.options.headerListMouseOver&&this._applyHeaderFocusedCellOut(),
this.pivotOverAttrName=null)},v.prototype.touchHandler=function(t){var e=t.changedTouches[0],i=document.createEvent("MouseEvent");i.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[t.type],!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i),t.preventDefault()};var f=function(){};f.prototype.drawPivotTable=function(t){try{l.D.isIEAllVersion()?s.v.setTimer((function(t,e){s.v.setTimer(this._drawPivotTableWhere,{key:this.id+"_drawPivotTableWhere",caller:this,delay:1,args:[t,e],callback:function(t){}})}),{key:this.id+"_drawPivotTable",caller:this,delay:1,args:[this.scrollY.startRowIndex,this.scrollX.startColIndex]}):this._drawPivotTableWhere(this.scrollY.startRowIndex,this.scrollX.startColIndex)}catch(t){a.w.printStackTrace(t)}},f.prototype.rowColSpanSize=function(t,e){try{var i,o,s;for(i=0;e+i<t.length;){s=!1;o=0;for(var n=e;0<=n?o<=n:o>=n;0<=n?++o:--o)t[e]!==t[e+i]&&(s=!0);if(s)break;i++}return e+i===t.length?i+1:1}catch(t){a.w.printStackTrace(t)}},f.prototype.calculateSpanSize=function(t,e,i,o,s){try{var n=-1;if("spanX"==t)if(this.scrollX.skipInfo&&!this.scrollX.skipInfo.depth[e]&&(this.scrollX.skipInfo.depth[e]={}),this.scrollX.skipInfo&&this.scrollX.skipInfo.depth[e][i])n=-1;else{var l=i;if(void 0===(c=this.spanInfo.spanX.depth[e].spanSize[l]))for(var r=l;l>-1;l--)if(void 0!==this.spanInfo.spanX.depth[e].spanSize[l]){c=this.spanInfo.spanX.depth[e].spanSize[l];break}var h=0;o+this.options.fixedColumn>l&&(h=o+this.options.fixedColumn-l),n=c-h;var d=i;if(this.scrollX.skipInfo)for(r=0;r<n;r++)this.scrollX.skipInfo.depth[e][d]=!0,d++}else if("spanY"==t)if(this.scrollY.skipInfo.depth[i]||(this.scrollY.skipInfo.depth[i]={}),this.scrollY.skipInfo.depth[i][e])n=-1;else{var c;l=e;if(void 0===(c=this.spanInfo.spanY.depth[i].spanSize[e]))for(r=l;l>-1;l--)if(void 0!==this.spanInfo.spanY.depth[i].spanSize[l]){c=this.spanInfo.spanY.depth[i].spanSize[l];break}h=0;o+this.options.fixedRow>l&&(h=o+this.options.fixedRow-l),n=c-h;var p=e;for(r=0;r<n;r++)this.scrollY.skipInfo.depth[i][p]=!0,p++}return n}catch(t){a.w.printStackTrace(t)}},f.prototype.getSpanSize=function(t,e,i){try{switch(t){case"spanX":return this.spanInfo[t][i][e];case"spanY":return this.spanInfo[t][e][i]}}catch(t){a.w.printStackTrace(t)}},f.prototype._drawPivotTableWhere=function(t,e){try{if(this.rowIndex==t&&this.colIndex==e)return;this.editingTD&&this.endCellEditMode(),this.scrollX.skipInfo={depth:{}},this.scrollY.skipInfo={depth:{}};var i=this.hasProp,o=this.opts,s=this.pivotData,n=s.colAttrs,r=s.rowAttrs,h=s.getRowKeys(),d=s.getColKeys(),c=s.colKeys.length,p=this.pivotDataArr,u=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_header_TR"),v=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_content_TR"),f=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_gtotal_TR");if(0===n.length&&d.length>0&&(n=_.flatten(d)),this.colIndex!=e)for(var g=0;g<n.length;g++)if(i.call(n,g)){for(var m=0,y=(m=this.options.fixedColumn,0),w=u[g],C=w.getElementsByClassName("type2"),x=0,b=0;b<C.length&&(x+=parseInt(C[b].getAttribute("colspan"),10))<=this.options.fixedColumn;b++)m++;for(var T=0,I=e+this.options.fixedColumn;I<d.length;I++,T++)if(i.call(d,I)){var D=d[I],A=0;if(-1!==(U=this.calculateSpanSize("spanX",g,I,e))){if(A++,!(y<this.maxViewCellX))break;var S=y+U;this.maxViewCellX<S?y+=U-=S-this.maxViewCellX:y=S,(nt=C[m])||((nt=document.createElement("th")).className="type2 pvtColLabel",w.appendChild(nt),C=w.getElementsByClassName("type2")),nt.setAttribute("colspan",U),nt.setAttribute("rowspan",1),g===n.length-1&&0!==r.length&&nt.setAttribute("rowspan",2),l.D.isIEAllVersion()&&1!=this.options.showGrandTotal?"hidden"==nt.style.visibility&&(nt.style.visibility="",nt.style.borderWidth="1px"):"none"==nt.style.display&&(nt.style.display="");var E=o.attributeLabels[D[g]]||D[g],L=D.join(String.fromCharCode(0))
;if(this.headerDataNameFormatter&&(E=this.headerDataNameFormatter(this.pivotData.realRowIndexByColKeys[L],n[g],E,this.data[this.pivotData.realRowIndexByColKeys[L]])),nt.innerHTML=E,1==U){var M=this.pivotDOM.colGroup[this.fixedCellX+this.options.fixedColumn+T];if(M&&parseInt(M.style.width)!=Math.round(this.colWidthInfo[I])){var k=this.colWidthInfo[I];WebSquare.style.setStyle(M,"width",k),M.style.width=k+"px"}}else{for(var N=0,F=I;F<U+I;F++)N+=this.colWidthInfo[F];nt.style.width=N+"px"}m++}}for(b=m;b<C.length;b++){var W=C[b];l.D.isIEAllVersion()&&1!=this.options.showGrandTotal?""==W.style.visibility&&(W.style.visibility="hidden",W.style.borderWidth="0px"):""==W.style.display&&(l.D.isIEAllVersion()&&1==this.options.showGrandTotal&&(W.style.width="0px"),W.style.display="none")}if(0<this.maxViewCellX-(d.length-e)&&d.length-this.maxViewCellX<e&&this.options.showGrandTotal&&("both"==this.options.grandTotalDisplayType||"vertical"==this.options.grandTotalDisplayType)&&0===g){m=0;if("col"===s.valuesAxis){if(s.colAttrs.length>0)for(var R=w.getElementsByClassName("type3"),B=0;B<s.valAttrs.length;B++){if((nt=R[m])||((nt=document.createElement("th")).className="type3 pvtTotalLabel",w.appendChild(nt),R=w.getElementsByClassName("type3")),nt.setAttribute("rowspan",n.length+(0===r.length?0:1)),nt.innerHTML=o.attributeLabels[s.valAttrs[B]]||s.valAttrs[B],P=this.pivotDOM.colGroup[this.fixedCellX+this.options.fixedColumn+T+B]){k=this.colWidthInfo[I+B];WebSquare.style.setStyle(P,"width",k),P.style.width=k+"px"}m++}}else if(s.colAttrs.length>0){var P;if((nt=(R=w.getElementsByClassName("type4"))[m])||((nt=document.createElement("th")).className="type4 pvtTotalLabel",w.appendChild(nt),R=w.getElementsByClassName("type4")),nt.setAttribute("rowspan",n.length+(0===r.length?0:1)),nt.innerHTML=this.options.allTotalName?this.options.allTotalName:o.localeStrings.totals,P=this.pivotDOM.colGroup[this.fixedCellX+this.options.fixedColumn+T]){k=this.colWidthInfo[I];WebSquare.style.setStyle(P,"width",k),P.style.width=k+"px"}m++}if(R)for(b=m;b<R.length;b++){W=R[b];l.D.isIEAllVersion()||l.D.isSpartan()?""==W.style.visibility&&(W.style.visibility="hidden",W.style.borderWidth="0px"):""==W.style.display&&(W.style.display="none")}}}if(s.valAttrs){var O=0;for(g=t;g<h.length;g++)if(i.call(h,g)){if(t+this.maxViewCellY<g)break;var X=v[O],H=h[g],V=H.join(String.fromCharCode(0));if((l.D.isIEAllVersion()||l.D.isSpartan())&&"hidden"==X.style.visibility?(X.style.visibility="",X.style.borderWidth="1px"):"none"==X.style.display&&(X.style.display=""),this.rowIndex!=t){m=0;var z=X.getElementsByClassName("type7"),K=H.slice(0,H.length),Y=l.D.getDataPrefix("header-data");for(I=0;I<H.length;I++)if(O<this.options.fixedRow)m++;else if(i.call(H,I)){var q=H[I],U=this.calculateSpanSize("spanY",g,I,t,O);if(this.options.headerYMerge)if(-1!==U&&K.length>0){var j=this.rowColSpanSize(K,0);if(K=K.slice(j),-1!==j){(nt=z[m])||((nt=document.createElement("th")).className="type7 pvtRowLabel",X.insertBefore(nt,X.childNodes[m]),z=X.getElementsByClassName("type7")),nt.setAttribute("rowspan",U),K.length>0?nt.setAttribute("colspan",j):0!==K.length&&I!==r.length-1||0===n.length||(1==r.length&&r[0]==this.options.grandTotalName||1==n.length&&n[0]==this.options.grandTotalName?nt.setAttribute("colspan",1):nt.setAttribute("colspan",j)),(1==this.options.headerListMouseOver&&this.options.headerListMouseOverColor||this.options.headerBackgroundColor)&&nt.setAttribute(Y,"row:"+I),"none"==nt.style.display&&(nt.style.display="");E=o.attributeLabels[q]||q;this.headerDataNameFormatter&&(E=this.headerDataNameFormatter(this.pivotData.realRowIndexByRowKeys[V],r[I],E,this.data[this.pivotData.realRowIndexByRowKeys[V]])),nt.innerHTML=E,m++}}else K=K.slice(1);else if(-1!==U){(nt=z[m])||((nt=document.createElement("th")).className="type7 pvtRowLabel",X.insertBefore(nt,X.childNodes[m]),z=X.getElementsByClassName("type7")),nt.setAttribute("rowspan",U),
I===r.length-1&&0!==n.length&&n[0]!=this.options.grandTotalName?nt.setAttribute("colspan",2):nt.setAttribute("colspan",1),(1==this.options.headerListMouseOver&&this.options.headerListMouseOverColor||this.options.headerBackgroundColor)&&nt.setAttribute(Y,"row:"+I),"none"==nt.style.display&&(nt.style.display="");E=o.attributeLabels[q]||q;this.headerDataNameFormatter&&(E=this.headerDataNameFormatter(this.pivotData.realRowIndexByRowKeys[V],r[I],E,this.data[this.pivotData.realRowIndexByRowKeys[V]])),nt.innerHTML=E,m++}}for(B=m;B<z.length;B++){if(!(W=z[B]))break;""==W.style.display&&(W.style.display="none")}}var G=0;this.colIndex!=e&&(G=this.options.fixedColumn);var $=G,J=X.getElementsByClassName("type8"),Z=0;for(A=e+G;A<d.length&&Z<this.maxViewCellX;A++)if(Z++,O<this.options.fixedRow&&this.colIndex==e)$++;else if($<G)$++;else if(i.call(d,A)){if((rt=J[$])||((rt=document.createElement("td")).className="w2editablePivot_cell type8 pvtVal row"+b+" col"+pt,X.appendChild(rt),J=X.getElementsByClassName("type8")),l.D.isIEAllVersion()&&1!=this.options.showGrandTotal||this.options.showGrandTotal&&"horizontal"===this.options.grandTotalDisplayType&&l.D.isChrome()||!this.options.showGrandTotal&&l.D.isChrome()?"hidden"==rt.style.visibility&&(rt.style.visibility="",rt.style.borderWidth="1px"):"none"==rt.style.display&&(rt.style.display=""),rt.setAttribute("data-coordinate",g+","+A),null===(ot=p[g*c+A]))-1==rt.className.indexOf("w2editablePivot_cellDisabled")&&"true"==this.options.editablePivotMode&&(rt.className+=" w2editablePivot_cellDisabled");else{var Q=rt.className+" ";Q.indexOf("w2editablePivot_cellDisabled")>-1&&(Q=Q.replace("w2editablePivot_cellDisabled ",""),rt.className=Q)}if(this.numberFormatter&&null!=ot){var tt={rowIndex:g,colIndex:A,rowKey:H,colKey:d[A],value:ot};ot=this.numberFormatter(tt)}1==this.options.showZero&&1!=this.options.useNumberFormat?(null!=ot&&""!=ot||(ot=0),rt.innerHTML=ot):1==this.options.useNumberFormat?rt.innerHTML=ot||this._pivotNumberFormatter(ot):rt.innerHTML=ot||"",$++}for(b=$;b<J.length;b++){var et=J[b];l.D.isIEAllVersion()&&1!=this.options.showGrandTotal||this.options.showGrandTotal&&"horizontal"===this.options.grandTotalDisplayType&&l.D.isChrome()||!this.options.showGrandTotal&&l.D.isChrome()?""==et.style.visibility&&(et.style.visibility="hidden",et.style.borderWidth="0px"):""==et.style.display&&(l.D.isIEAllVersion()&&1==this.options.showGrandTotal&&(et.style.width="0px"),et.style.display="none")}if(0<this.maxViewCellX-(d.length-e)&&d.length-this.maxViewCellX<e&&this.options.showGrandTotal&&("both"==this.options.grandTotalDisplayType||"vertical"==this.options.grandTotalDisplayType)){this.isDrawedGTX=!0;$=0,J=[];if("col"===s.valuesAxis){if(s.colAttrs.length>0&&(1!=s.colAttrs.length||s.colAttrs[0]!==this.options.grandTotalName)||0===s.colAttrs.length&&1===s.rowAttrs.length&&1===s.valAttrs.length){J=X.getElementsByClassName("type9");var it=s.valAttrs.length;for(B=0;B<it;B++){(rt=J[$])||((rt=document.createElement("td")).className="w2editablePivot_cell type9 pvtTotal rowTotal ",rt.setAttribute("data-attr",s.valAttrs[B]),X.appendChild(rt),J=X.getElementsByClassName("type9")),this.options.totalYTextAlign&&(rt.style.textAlign=this.options.totalYTextAlign);var ot=this.rowTotalDataArr[g*it+B];if(1==this.options.showZero&&1!=this.options.useNumberFormat?(null!=ot&&""!=ot||(ot=0),rt.innerHTML=ot):1==this.options.useNumberFormat?rt.innerHTML=ot||this._pivotNumberFormatter(ot):rt.innerHTML=ot||"",this.numberFormatter&&null!=ot){tt={rowIndex:g,value:ot,rowKey:H,colKey:s.valAttrs[B]};ot=this.numberFormatter(tt)}rt.innerHTML=ot,$++}}}else if(1!=n.length||n[0]!==this.options.grandTotalName){(rt=(J=X.getElementsByClassName("type10"))[$])||(rt=document.createElement("td"),
O<this.options.fixedRow?O==this.options.fixedRow-1?rt.className="w2editablePivot_cell type10 w2editablePivot_fixedRowCell fixedCell pvtTotal rowTotal":rt.className="w2editablePivot_cell type10 fixedCell pvtTotal rowTotal":rt.className="w2editablePivot_cell type10 pvtTotal rowTotal",X.appendChild(rt),J=X.getElementsByClassName("type10")),this.options.totalYTextAlign&&(rt.style.textAlign=this.options.totalYTextAlign);ot=this.rowTotalDataArr[g];if(1==this.options.useNumberFormat&&(ot||(ot=this._pivotNumberFormatter(ot))),this.numberFormatter&&null!=ot){tt={rowIndex:g,value:ot,rowKey:H,colKey:dt=this.options.allTotalName?this.options.allTotalName:o.localeStrings.totals};ot=this.numberFormatter(tt)}rt.innerHTML=ot,$++}for(b=$;b<J.length;b++){et=J[b];l.D.isIEAllVersion()||l.D.isSpartan()?""==et.style.visibility&&(et.style.visibility="hidden",et.style.borderWidth="0px"):""==et.style.display&&(et.style.display="none")}}else this.isDrawedGTX=!1;O++}}for(B=O;B<v.length;B++){var st=v[B];""==st.style.display&&(st.style.display="none")}O=0;if(0<this.maxViewCellY-(h.length-t)&&h.length-this.maxViewCellY<t&&this.options.showGrandTotal&&("both"==this.options.grandTotalDisplayType||"horizontal"==this.options.grandTotalDisplayType)){this.isDrawedGTY=!0;X=f[O];if("col"===s.valuesAxis){X||((X=document.createElement("TR")).className="w2editablePivot_contentTable_gtotal_TR",X.setAttribute("data-attr","GrandTotal"),this.pivotDOM.pivotTABLE.getElementsByTagName("tbody")[0].appendChild(X),f=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_gtotal_TR")),O++,(nt=(z=X.getElementsByTagName("TH"))[0])||((nt=document.createElement("TH")).className="type11 pvtTotalLabel",nt.setAttribute("rowSpan",1),X.appendChild(nt)),l.D.isIEAllVersion()||l.D.isSpartan()?"hidden"==nt.style.visibility&&(nt.style.visibility="",nt.style.borderWidth="1px"):"none"==nt.style.display&&(nt.style.display=""),1==s.colAttrs.length&&s.colAttrs[0]===this.options.grandTotalName?nt.setAttribute("colspan",r.length):nt.setAttribute("colspan",r.length+(0===n.length?0:1)),dt=this.options.allTotalName?this.options.allTotalName:o.localeStrings.totals,nt.innerHTML=dt;J=X.getElementsByTagName("td"),$=0,Z=0;var at=!1;for(I=e;I<d.length;I++){if(!(Z<this.maxViewCellX)){at=!0;break}if(Z++,i.call(d,I)){if(!(rt=J[$]))(rt=document.createElement("td")).className="w2editablePivot_cell type12 pvtTotal colTotal",X.appendChild(rt),J=X.getElementsByTagName("td");this.options.totalXTextAlign&&(rt.style.textAlign=this.options.totalXTextAlign),l.D.isIEAllVersion()||l.D.isSpartan()?"hidden"==rt.style.visibility&&(rt.style.visibility="",rt.style.borderWidth="1px"):"none"==rt.style.display&&(rt.style.display="");ot=this.colTotalDataArr[I];if(this.numberFormatter&&null!=ot){tt={colIndex:I,value:ot,rowKey:dt,colKey:d[I]};ot=this.numberFormatter(tt)}1==this.options.showZero&&1!=this.options.useNumberFormat?(null!=ot&&""!=ot||(ot=0),rt.innerHTML=ot):1==this.options.useNumberFormat?rt.innerHTML=ot||this._pivotNumberFormatter(ot):rt.innerHTML=ot||"",rt.innerHTML=ot,$++}}if(!at&&"both"==this.options.grandTotalDisplayType&&s.colAttrs.length>0||1===s.valAttrs.length&&(0===s.colAttrs.length||0===s.rowAttrs.length)){if(this.isDrawedGTT=!0,1!=s.colAttrs.length||s.colAttrs[0]!==this.options.grandTotalName)for(b=0;b<s.valAttrs.length;b++){if(!(rt=J[$]))(rt=document.createElement("td")).className="type13 pvtGrandTotal",rt.setAttribute("data-attr",s.valAttrs[b]),X.appendChild(rt),J=X.getElementsByTagName("td");this.options.totalXTextAlign&&(rt.style.textAlign=this.options.totalXTextAlign),l.D.isIEAllVersion()||l.D.isSpartan()?"hidden"==rt.style.visibility&&(rt.style.visibility="",rt.style.borderWidth="1px"):"none"==rt.style.display&&(rt.style.display="");ot=this.allTotalDataArr[b];if(this.numberFormatter&&null!=ot){tt={value:ot,rowKey:dt,colKey:s.valAttrs[b]};ot=this.numberFormatter(tt)}rt.innerHTML=ot,$++}}else this.isDrawedGTT=!1;for(B=$;B<J.length;B++){et=J[B]
;l.D.isIEAllVersion()||l.D.isSpartan()?""==et.style.visibility&&(et.style.visibility="hidden",et.style.borderWidth="0px"):""==et.style.display&&(et.style.display="none")}}else if(s.rowAttrs.length>0&&(1!=s.rowAttrs.length||s.rowAttrs[0]!=this.options.grandTotalName)||1===s.valAttrs.length&&(0===s.colAttrs.length||0===s.rowAttrs.length))for(it=s.valAttrs.length,b=0;b<it;b++){var nt;(X=f[O])||((X=document.createElement("TR")).className="w2editablePivot_contentTable_gtotal_TR",X.setAttribute("data-attr",s.valAttrs[b]),this.pivotDOM.pivotTABLE.getElementsByTagName("tbody")[0].appendChild(X),f=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_gtotal_TR")),O++,(nt=(z=X.getElementsByTagName("th"))[0])||((nt=document.createElement("TH")).className="type14 pvtTotalLabel",nt.setAttribute("rowSpan",1),X.appendChild(nt)),l.D.isIEAllVersion()||l.D.isSpartan()?"hidden"==nt.style.visibility&&(nt.style.visibility="",nt.style.borderWidth="1px"):"none"==nt.style.display&&(nt.style.display=""),1==n.length&&n[0]==this.options.grandTotalName?nt.setAttribute("colspan",r.length):nt.setAttribute("colspan",r.length+(0===n.length?0:1)),nt.innerHTML=o.attributeLabels[s.valAttrs[b]]||s.valAttrs[b];$=0,J=X.getElementsByTagName("td"),Z=0,at=!1;var lt=d.length;for(I=e;I<lt;I++){if(!(Z<this.maxViewCellX)){at=!0;break}if(Z++,i.call(d,I)){var rt=J[$],ht=!0;if(!rt){ht=!1;rt=document.createElement("td");this.options.totalXTextAlign&&(rt.style.textAlign=this.options.totalXTextAlign),$<this.options.fixedColumn?$==this.options.fixedColumn-1?rt.className="w2editablePivot_cell type15 w2editablePivot_fixedColumnCell fixedCell pvtTotal colTotal":rt.className="w2editablePivot_cell type15 fixedCell pvtTotal colTotal":rt.className="w2editablePivot_cell type15 pvtTotal colTotal",X.appendChild(rt),J=X.getElementsByTagName("td")}if(l.D.isIEAllVersion()||l.D.isSpartan()?"hidden"==rt.style.visibility&&(rt.style.visibility="",rt.style.borderWidth="1px"):"none"==rt.style.display&&(rt.style.display=""),0==ht||$>=this.options.fixedColumn){ot=this.colTotalDataArr[b*lt+I];if(1==this.options.useNumberFormat&&(ot||(ot=this._pivotNumberFormatter(ot))),this.numberFormatter&&null!=ot){tt={colIndex:I,value:ot,rowKey:s.valAttrs[b],colKey:d[I]};ot=this.numberFormatter(tt)}rt.innerHTML=ot}$++}}for(B=$;B<J.length;B++){et=J[B];l.D.isIEAllVersion()||l.D.isSpartan()?""==et.style.visibility&&(et.style.visibility="hidden",et.style.borderWidth="0px"):""==et.style.display&&(et.style.display="none")}if(at||"both"!=this.options.grandTotalDisplayType)this.isDrawedGTT=!1;else{if(this.isDrawedGTT=!0,!(rt=J[$]))(rt=document.createElement("td")).className="type16 pvtGrandTotal",X.appendChild(rt),J=X.getElementsByTagName("td");this.options.totalXTextAlign&&(rt.style.textAlign=this.options.totalXTextAlign),l.D.isIEAllVersion()||l.D.isSpartan()?"hidden"==rt.style.visibility&&(rt.style.visibility="",rt.style.borderWidth="1px"):"none"==rt.style.display&&(rt.style.display="");ot=this.allTotalDataArr[b];if(1==this.options.useNumberFormat&&(ot||(ot=this._pivotNumberFormatter(ot))),this.numberFormatter&&null!=ot){var dt=this.options.allTotalName?this.options.allTotalName:o.localeStrings.totals;tt={value:ot,rowKey:s.valAttrs[b],colKey:dt};ot=this.numberFormatter(tt)}rt.innerHTML=ot,$++}}}else this.isDrawedGTY=!1;if(this.rowIndex===t&&this.colIndex===e||this.changeFocusedCellPosition(t,e),l.D.isSafari()&&0!=e){for(var ct=this.pivotHeaderXWidth,pt=0;pt<this.maxViewCellX;pt++)this.colWidthInfo[pt+e]&&(ct+=this.colWidthInfo[pt+e]);var ut=this.id+"_pvtTable";this.getElementById(ut).style.width=ct+"px"}this.colIndex=e,this.rowIndex=t,this.scrollX.skipInfo=null,this.scrollY.skipInfo=null}catch(t){a.w.printStackTrace(t)}},f.prototype.showContextMenu=function(t){try{this.contextMenu?this._showContextMenu(t):this.createContextMenu(t)}catch(t){a.w.printStackTrace(t)}},f.prototype.createContextMenu=function(t){try{
"<w2:list xmlns:w2=\"http://www.inswave.com/websquare\" tagName='div' style='' class='w2editablePivot_contextMenu'>","\t<w2:listRow tagName='div' style='height: 20px; display:block; border-top: 0px; border-left:0px; border-right:0px;' class='w2editablePivot_contextMenu_row'>","\t\t<w2:listColumn id='col1' inputType='text' style='padding-left: 10px' class='w2editablePivot_contextMenu_column'/>","\t</w2:listRow>","</w2:list>";var e=WebSquare.xml.parse("<w2:list xmlns:w2=\"http://www.inswave.com/websquare\" tagName='div' style='' class='w2editablePivot_contextMenu'>\t<w2:listRow tagName='div' style='height: 20px; display:block; border-top: 0px; border-left:0px; border-right:0px;' class='w2editablePivot_contextMenu_row'>\t\t<w2:listColumn id='col1' inputType='text' style='padding-left: 10px' class='w2editablePivot_contextMenu_column'/>\t</w2:listRow></w2:list>",!0).documentElement;this.contextMenu=new WebSquare.uiplugin.list(this.id+"_contextMenu_list","",e),this.contextMenu.writeTo(WebSquare.getBody()),this.contextMenu.activate(),this.contextMenu.info=t;var i=this;this.contextMenu.event.addListener(this.contextMenu.render,"onclick",(function(t){n.B.stopPropagation(t);for(var e,o,s=i.event.getTargetIterator(t,this.render),a=i.contextMenu;s.next();){if(s.match("w2editablePivot_contextMenu_column")){e=s.getElement().parentNode;break}if(s.match("w2editablePivot_contextMenu_row")){e=s.getElement();break}if(s.match("w2editablePivot_contextMenu"))break}for(var l=0;l<a.getLength();l++)if(e==a.render.childNodes[l]){o=l;break}i.callContextMenuAPI(o,i.contextMenu.info),i.hideContextMenu(),a.info=null})),this.contextMenu.event.addListener(this.contextMenu.render,"oncontextmenu",(function(t){n.B.preventDefault(t)}));var o=this.getContextMenuData(t),s=31*o.length;this.contextMenu.show(),this.contextMenu.isShow=!0,this.contextMenu.setSize(180,s);var l=n.B.getMouseY(t.e),r=n.B.getMouseX(t.e);document.documentElement.clientHeight<l+s+10&&(l-=s+10),document.documentElement.clientWidth<r+190&&(r-=190),this.contextMenu.setPosition(r,l),this.contextMenu.setJSON(o),this.contextMenu.info=t}catch(t){a.w.printStackTrace(t)}},f.prototype.getContextMenuData=function(t){try{var e=[],i=[],o=l.D.getGlobalFunction(this.options.contextMenuGetter,this.scope_id);"function"==typeof o&&(i=o()),this.contextMenu.callbackFunctionList=[];for(var s=0;s<i.length;s++)this.contextMenu.callbackFunctionList.push(i[s].callback),e.push({col1:i[s].label});return e}catch(t){a.w.printStackTrace(t)}},f.prototype._showContextMenu=function(t){try{this.contextMenu.isShow=!0;var e=this.getContextMenuData(t),i=31*e.length;this.contextMenu.show(),this.contextMenu.setSize(180,i);var o=n.B.getMouseY(t.e),s=n.B.getMouseX(t.e);document.documentElement.clientHeight<o+i+10&&(o-=i+10),document.documentElement.clientWidth<s+190&&(s-=190),this.contextMenu.setPosition(s,o),this.contextMenu.setJSON(e),this.contextMenu.info=t}catch(t){a.w.printStackTrace(t)}},f.prototype.hideContextMenu=function(){try{this.contextMenu&&this.contextMenu.hide()}catch(t){a.w.printStackTrace(t)}},f.prototype.callContextMenuAPI=function(t,e){try{this.contextMenu.callbackFunctionList[t](e)}catch(t){a.w.printStackTrace(t)}},f.prototype.movePivotAxis=function(t,e,i){try{this.options.rows=this.pivotData.rowAttrs.join(","),this.options.cols=this.pivotData.colAttrs.join(","),this.options.vals=this.pivotData.valAttrs.join(","),this.options.valuesAxis=this.pivotData.valuesAxis;for(var o,s=t[0],n=t[1]-0,l=0;l<this.columnInfoList.length;l++)if(this.columnInfoList[l].name==t[2]||this.columnInfoList[l].id==t[2]){o=this.columnInfoList[l].id;break}if(!o)return;var r=e[0],h=e[1]-0,d=this.options.rows.length>0?this.options.rows.split(this.seperator):[],c=this.options.cols.length>0?this.options.cols.split(this.seperator):[],p="col"==s?c:d,u="col"==r?c:d;if(s==r){if(n==h)return;var v=p.slice(0,n),f=p.slice(n+1);p=v.concat(f),(v=p.slice(0,h)).push(o);f=p.slice(h);p=v.concat(f),
"row"==s?this.options.rows=p.join(","):this.options.cols=p.join(",")}else{v=p.slice(0,n),f=p.slice(n+1);p=v.concat(f),(v=u.slice(0,h)).push(o);f=u.slice(h);u=v.concat(f),"row"==s?(this.options.rows=p.join(","),this.options.cols=u.join(",")):(this.options.rows=u.join(","),this.options.cols=p.join(","))}o==this.options.grandTotalName&&(this.pivotData.valuesAxis=r,this.options.valuesAxis=r),this.refreshItemset({refresh:!0,type:"render"})}catch(t){a.w.printStackTrace(t)}},f.prototype.movePivotHiddenList=function(t){try{this.options.rows=this.pivotData.rowAttrs.join(","),this.options.cols=this.pivotData.colAttrs.join(",");for(var e,i=t[0],o=t[1]-0,s=0;s<this.columnInfoList.length;s++)if(this.columnInfoList[s].name==t[2]||this.columnInfoList[s].id==t[2]){if(e=this.columnInfoList[s].id,this.columnInfoList[s].representativeValue&&"false"!=this.columnInfoList[s].dragToHidden&&(this.columnInfoList[s].inclusions=this.columnInfoList[s].representativeValue,this.columnInfoList[s].hidden=!0),"false"==this.columnInfoList[s].dragToHidden)return void alert(WebSquare.language.getMessage("Pivot_canNotMoveToHiddenList"));break}if(!e)return;var n=this.options.rows.split(this.seperator),l=this.options.cols.split(this.seperator),r="col"==i?l:n,h=r.slice(0,o),d=r.slice(o+1);r=h.concat(d),"row"==i?this.options.rows=r.join(","):this.options.cols=r.join(","),this.refreshItemset({refresh:!0,type:"render"})}catch(t){a.w.printStackTrace(t)}},f.prototype.refreshPivotCell=function(t){try{var e,i,o;e="other"==t.type?this.mappingDataInfoByRowIndex[t.rowIndex][t.valAttrColID]:this.mappingDataInfoByRowIndex[t.rowIndex][t.colID],this.mappingDataInfoByKey[e.flatRowKey][e.flatColKey],i=this.getRowIndexByKey(e.rowKey),o=this.getColIndexByKey(e.colKey);var s=i,n=o,l=this.getPivotCellDomWhere(i,o);if(!l)return;var r=this.getFormattedValue(i,o);if(this.pivotDataArr[s*this.pivotData.colKeys.length+n]=r,this.numberFormatter){t={rowIndex:i,colIndex:o,value:r};r=this.numberFormatter(t)}l.innerHTML=r;var h=this.rowIndex,d=this.colIndex;if(i-=h,o-=d,this.isDrawedGTX){var c=(y=this.getAggregator(e.rowKey,[],t.colID)).format(y.value());if("col"==this.pivotData.valuesAxis){for(var p=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_content_TR")[i].getElementsByClassName("type9"),u=0;u<p.length&&(m=p[u]).getAttribute("data-attr")!=t.colID;u++);this.rowTotalDataArr[s*this.pivotData.valAttrs.length+u]=c}else"row"==this.pivotData.valuesAxis&&(m=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_content_TR")[i].getElementsByClassName("type10")[0],this.rowTotalDataArr[s]=c);m.innerHTML=c}if(this.isDrawedGTY){var v,f=this.pivotDOM.pivotTABLE.getElementsByClassName("w2editablePivot_contentTable_gtotal_TR");c=(y=this.getAggregator([],e.colKey,t.colID)).format(y.value());if("col"==this.pivotData.valuesAxis)v=f[0],this.colTotalDataArr[n]=c;else if("row"==this.pivotData.valuesAxis){for(var g=0;g<f.length&&(v=f[g],t.colID!=v.getAttribute("data-attr"));g++);this.colTotalDataArr[g*this.pivotData.colKeys.length+n]=c}if((m=(p=v.getElementsByTagName("td"))[o]).innerHTML=c,this.isDrawedGTT){var m,y;c=(y=this.getAggregator([],[],t.colID)).format(y.value());if("col"==this.pivotData.valuesAxis){for(p=v.getElementsByClassName("type13"),g=0;g<p.length&&(m=p[g]).getAttribute("data-attr")!=t.colID;g++);this.allTotalDataArr[u]=c}else for(var w in m=v.getElementsByClassName("type16")[0],this.pivotData.valAttrs)this.pivotData.valAttrs[w]==t.colID&&(this.allTotalDataArr[w]=c);m.innerHTML=c}}}catch(t){a.w.printStackTrace(t)}},f.prototype.getPivotCellDomWhere=function(t,e){try{var i=this.rowIndex,o=this.colIndex;if(t-=i,e-=o,this.pivotDOM.tdMap[t])return this.pivotDOM.tdMap[t][e]}catch(t){a.w.printStackTrace(t)}},f.prototype._getPivotCellDomWhere=function(t,e){try{var i=this.getRowIndexByKey(t),o=this.getColIndexByKey(e);return this.getPivotCellDomWhere(i,o)}catch(t){a.w.printStackTrace(t)}},f.prototype.moveInputRenderTo=function(t){try{
this.editingInput.render.parentElement?t.appendChild(this.editingInput.render.parentElement.removeChild(this.editingInput.render)):t.appendChild(this.editingInput.render)}catch(t){a.w.printStackTrace(t)}},f.prototype._setAutoFit=function(t){if(0!=this.render.offsetWidth&&0!=this.render.offsetHeight){var e=(t=t||{}).type?t.type:this.options.autoFit,i=t.exceptCol,o=t.exceptWidth||0,s=this.scrollY.scrollY_AREA.offsetWidth,a=this.render.clientWidth,n=this.colWidthInfo.length-1;if("lastColumn"==e){this.autoFitPivotWidth||(this.autoFitPivotWidth=this.pivotWidth,this.orgLastWidth=this.cellWidth,this.orgLastVisibleCol=n),"number"==typeof i&&i!=n&&(this.autoFitPivotWidth+=o-this.colWidthInfo[i],this._setColumnWidth(i,o));var l=a-s-this.pivotWidth+this.colWidthInfo[n]-1;l>this.orgLastWidth?this._setColumnWidth(n,l):this._setColumnWidth(n,this.orgLastWidth)}else"allColumn"==e&&this._setColumnWidth(i,o)}},f.prototype.getColumnWidth=function(t){try{if(this.colWidthInfo[t])return this.colWidthInfo[t]}catch(t){a.w.printStackTrace(t)}},f.prototype.setColumnWidth=function(t,e){try{if(this.options.autoFit)this._setAutoFit({exceptCol:t,exceptWidth:e});else if(null===t||""===t||void 0===t){if(null!=e&&!isNaN(e)&&e>=0&&this.colWidthInfo.length>0){if(this.pivotDOM.tdMap[0].length<this.pivotData.colKeys.length){this.options.defalutCellWidth;this.options.defalutCellWidth=e,this.refreshRender(!0);this.options.defalutCellWidth;s.v.setTimer((function(t,i){for(var o=0;o<this.colWidthInfo.length;o++)e-this.colWidthInfo[o],this._setColumnWidth(o,e,!1);this.resizeContentAreaAfterSetColumnWidth()}),{key:this.id+"_setColumnWidth",caller:this,delay:100,args:[e]})}else{for(var i=0;i<this.colWidthInfo.length;i++)e-this.colWidthInfo[i],this._setColumnWidth(i,e,!1);this.resizeContentAreaAfterSetColumnWidth()}}}else if(t.constructor===Array){var o=t.slice(0),n=!1;if(e.constructor===Array){if(o.length!=e.length)return;n=!0}for(i=0;i<o.length;i++){var l=n?e[i]:e;this._setColumnWidth(o[i],l,!1)}this.resizeContentAreaAfterSetColumnWidth()}else null!=e&&!isNaN(e)&&e>=0&&this._setColumnWidth(t,e)}catch(t){a.w.printStackTrace(t)}},f.prototype._setColumnWidth=function(t,e){try{var i=0,o=e-this.colWidthInfo[t+this.colIndex];this.pivotWidth+=o,this.colWidthInfo[t+this.colIndex]=e;var s=0;if("allColumn"==this.options.autoFit)for(var n=this.pivotData.colKeys.length-1,r=parseInt(o/n),h=o%n,d=0;d<=n;d++,h--){t!=d?(this.colWidthInfo[d]-=r,h>0&&(this.colWidthInfo[d]-=1)):this.colWidthInfo[t+this.colIndex]=e-1;var c=this.pivotDOM.colGroup[this.fixedCellX+d];WebSquare.style.setStyle(c,"width",this.colWidthInfo[d]),c.style.width=this.colWidthInfo[d]+"px"}else{this.viewedColNum=0;for(d=this.colIndex;d<this.colWidthInfo.length;d++)i+=this.colWidthInfo[d],this.viewTotalCellWidth>i&&this.viewedColNum++;if(!this.colWidthInfo[d+1])for(var p=this.colIndex-1;p>0;p--)i+=this.colWidthInfo[p],this.viewTotalCellWidth>i&&(this.viewedColNum++,s++);if(t>=0){c=this.pivotDOM.colGroup[this.fixedCellX+t+s];WebSquare.style.setStyle(c,"width",e),c.style.width=e+"px"}if(this.maxViewCellWidthTotal+=o,l.D.isSafari()){var u=this.id+"_pvtTable",v=this.getElementById(u),f=parseInt(v.style.width);v.style.width=f+o+"px"}this.resizeContentAreaAfterSetColumnWidth()}}catch(t){a.w.printStackTrace(t,null,this)}},f.prototype._setAxisLabelColumnWidth=function(t,e){try{var i=this.pivotDOM.colGroup[t],o=e+parseInt(WebSquare.style.getStyle(i,"width"));WebSquare.style.setStyle(i,"width",o);for(var s=this.pivotData.rowAttrs.length,n=0,r=0;r<=s;r++){var h=this.pivotDOM.colGroup[r];n+=parseInt(WebSquare.style.getStyle(h,"width"))}if("allColumn"==this.options.autoFit){if(n+e>this.render.offsetWidth-100)return}else if(n+e+this.colWidthInfo[0]>this.render.offsetWidth-10)return;if(i.style.width=o+"px","allColumn"==this.options.autoFit){var d=this.pivotData.colKeys.length-1;"horizontal"!==this.options.grandTotalDisplayType&&(d+=1);var c=parseInt(e/(d+1)),p=e%(d+1);for(r=0;r<=d;r++){this.colWidthInfo[r]-=c,
p>0?(this.colWidthInfo[r]-=1,p--):p<0&&(this.colWidthInfo[r]+=1,p++);i=this.pivotDOM.colGroup[this.fixedCellX+r];WebSquare.style.setStyle(i,"width",this.colWidthInfo[r]),i.style.width=this.colWidthInfo[r]+"px"}}else{if(this.pivotWidth+=e,this.maxViewCellWidthTotal+=e,l.D.isSafari()){var u=this.id+"_pvtTable",v=this.getElementById(u),f=parseInt(v.style.width);v.style.width=f+e+"px"}this.resizeContentAreaAfterSetColumnWidth()}}catch(t){a.w.printStackTrace(t,null,this)}},f.prototype.arrangeOverflowXScroll=function(){try{this.fixedWidth=0;for(var t=this.getFixedColumnLastIndex(),e=0;e<t;e++)this.fixedWidth+=this.colWidthInfo[e]}catch(t){a.w.printStackTrace(t,null,this)}},f.prototype.getFixedColumnLastIndex=function(){try{var t=this.options.fixedColumn;return t<1?0:t}catch(t){a.w.printStackTrace(t,null,this)}},f.prototype.setOverflowX=function(t){};var g=function(){};g.prototype.handleBodyKeyDown=function(t){try{if(this.isKeyPressed=!0,this.isEditting)switch(t.keyCode){case 9:var e=!0;n.B.stopEvent(t);case 13:var i,o=(i=this.getCoordinate(this.editingTD)).rowIndex,r=i.colIndex,h=this.getValue(o,r);if(this.endCellEditMode()+""!="false"){var d;h!=(d=this.getValue(o,r))&&n.B.fireEvent(this,"onviewchange",{oldValue:h,newValue:d,rowIndex:o,colIndex:r});var c=!1;"right"==this.options.enterKeyMove||e?c=this.moveHorizontal(t,t.shiftKey?"left":"right",this.options.keyMoveEditMode):"none"!=this.options.enterKeyMove&&(c=this.moveVertical(t,t.shiftKey?"up":"down",this.options.keyMoveEditMode)),c||this.setFocusedCell(this.isEditting)}break;case 27:this.handleCancelEdit(t),this.setFocusedCell(),n.B.stopEvent(t)}else{if("none"!=this.options.focusMode&&(-1==this.getFocusedRowIndex()||null==this.getFocusedColumnIndex()))return void(13==t.keyCode&&document.activeElement==this.render&&(this.setFocusedCell(),n.B.stopEvent(t)));if(s.v.browserCheck.safari&&(t.ctrlKey||t.metaKey)){this.tempEditableCell=document.activeElement,this.tempEditableCell.contentEditable="true",this.tempEditableCell.style.textShadow="0 0 0 "+WebSquare.style.getStyle(this.tempEditableCell,"color"),this.tempEditableCell.style.color="transparent";var p=this;s.v.setTimer((function(){p.tempEditableCell.contentEditable="inherit",this.tempEditableCell.style.color="",this.tempEditableCell.style.textShadow=""}),{key:this.id+"_tempEditableCell_contentEditable",caller:this,delay:500})}switch(t.keyCode){case 37:case 39:case 38:case 40:case 33:case 34:case 35:case 36:case 9:!0;case 13:!0;break;default:!1}switch(t.keyCode){case 4:case 16:case 17:case 18:case 21:case 229:case 25:case 91:case 20:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:break;case 46:"true"==this.options.editablePivotMode&&(this.removeCellData(t),n.B.stopEvent(t));break;case 32:this.doDefaultAction(t);break;case 33:this.movePageUp(t),n.B.stopEvent(t);break;case 34:this.movePageDown(t),n.B.stopEvent(t);break;case 35:this.moveHorizontal(t,"end"),n.B.stopEvent(t);break;case 36:this.moveHorizontal(t,"home"),n.B.stopEvent(t);break;case 37:this.moveHorizontal(t,"left"),n.B.stopEvent(t);break;case 38:this.moveVertical(t,"up"),n.B.stopEvent(t);break;case 39:this.moveHorizontal(t,"right"),n.B.stopEvent(t);break;case 40:this.moveVertical(t,"down"),n.B.stopEvent(t);break;case 9:if(this.options.senseReader&&this.options.focusImage&&this.getLastFocusedCell().focusedColIndex);else if(n.B.getTarget(t)==this.render)this.getLastFocusedCell().focusedTd.setAttribute("tabIndex",-1);else if(this.options.tabKeyEditMode){if(!t.ctrlKey&&!t.metaKey)l.D.getBoolean(t.srcElement.getAttribute("directItemChoice"))&&(this.directItemChoiceKeyObj.select=t.keyCode),this.setEditHtml(t),n.B.stopEvent(t)}else{(this.moveHorizontal(t,t.shiftKey?"left":"right",this.options.keyMoveEditMode)||"linear"!=this.options.focusFlow)&&n.B.stopEvent(t)}break;case 13:if("edit"==this.options.enterKeyMove){this.setEditHtml(t);break}
"none"==this.options.enterKeyMove||("right"==this.options.enterKeyMove?this.moveHorizontal(t,t.shiftKey?"left":"right",this.options.keyMoveEditMode):this.moveVertical(t,t.shiftKey?"up":"down",this.options.keyMoveEditMode)),n.B.stopEvent(t);break;case 67:if(t.ctrlKey||t.metaKey){if(l.D.isIEAllVersion())this.handleCopyEvent({});else if(!l.D.isIEAllVersion()&&(s.v.browserCheck.moz||s.v.browserCheck.chrome)){var u=document.createElement("textarea"),v=(p=this,document.getElementsByTagName("body")[0]);u.oncopy=function(t){p.handleCopyEvent(t),v.removeChild(this)},u.textContent="temp",v.appendChild(u),u.select();try{document.execCommand("copy")}catch(t){a.w.printStackTrace(t,null,this)}}}else l.D.getBoolean(t.srcElement.getAttribute("directItemChoice"))&&(this.directItemChoiceKeyObj.select=t.keyCode),this.setEditHtml(t);break;case 86:if("true"==this.options.editablePivotMode&&(t.ctrlKey||t.metaKey)){if(l.D.isIEAllVersion())this.handlePasteEvent({});else if(!l.D.isIEAllVersion()&&(s.v.browserCheck.moz||s.v.browserCheck.chrome||s.v.browserCheck.safari)){u=document.createElement("textarea"),p=this;u.onpaste=function(t){p.handlePasteEvent(t),v.removeChild(this)},u.textContent="temp",(v=document.getElementsByTagName("body")[0]).appendChild(u),u.select();try{document.execCommand("paste")}catch(t){a.w.printStackTrace(t,null,this)}}}else l.D.getBoolean(t.srcElement.getAttribute("directItemChoice"))&&(this.directItemChoiceKeyObj.select=t.keyCode),this.setEditHtml(t);break;case 89:"true"==this.options.editablePivotMode&&t.ctrlKey&&!this.isEditting&&this.options.undoRedo&&this._dataList.redoMulti();break;case 90:if(t.ctrlKey)"true"==this.options.editablePivotMode&&this.options.undoRedo&&(this.isEditting||this._dataList.restoreMulti());else l.D.getBoolean(t.srcElement.getAttribute("directItemChoice"))&&(this.directItemChoiceKeyObj.select=t.keyCode),this.setEditHtml(t);break;case 27:"none"!=this.options.focusMode&&"linear"!=this.options.focusFlow&&(this.getLastFocusedCell().focusedTd.setAttribute("tabIndex",-1),this.render.focus());break;default:if(!t.ctrlKey&&!t.metaKey)l.D.getBoolean(t.srcElement.getAttribute("directItemChoice"))&&(this.directItemChoiceKeyObj.select=t.keyCode),this.setEditHtml(t)}}this.isKeyPressed=!1}catch(t){a.w.printStackTrace(t)}},g.prototype.setEditHtml=function(t){try{if(this.focusedCell.length>0&&"true"==this.options.editablePivotMode){var e=this.focusedCell[this.focusedCell.length-1];null!=e.focusedTd&&-1==e.focusedTd.className.indexOf("w2editablePivot_cellDisabled")&&this.setCellEditMode(e.focusedTd)}}catch(t){a.w.printStackTrace(t)}},g.prototype.removeCellData=function(t){try{if("true"!=this.options.editablePivotMode)return;var e=this.focusedCell,i=[];this.deletedCell=[];for(var o=0;o<e.length;o++)if(e[o].focusedTd){var s=e[o].focusedTd.getAttribute("data-coordinate").split(","),n=s[0],l=s[1],r=this.setValue(n,l,"");r&&(this.deletedCell.push(r),i.push(r))}this.options.undoRedo&&this._dataList.undoRedoSave(i)}catch(t){a.w.printStackTrace(t)}},g.prototype.moveHorizontal=function(t,e,i){if("false"==this.options.focusMove||"vertical"==this.options.focusMove){var o=t.charCode?t.charCode:t.keyCode;if(!this.options.senseReader)return!1;if(9!=o)return!1}var s=null,a=this.getLastFocusedCell(),n=a.focusedRowIndex,l=a.focusedColIndex,r=this.pivotData.colKeys.length;e=e||"right";if(this.options.focusMultiRow);else switch(e){case"left":if((s=l-1)<0)return;break;case"right":if((s=l+1)>r-1)return}if(null!==s){for(var h=this.colIndex,d=0,c=0,p=this.colIndex;p<this.colWidthInfo.length;p++)c+=this.colWidthInfo[p],this.viewTotalCellWidth>c&&d++;return h+d<=s?(this._drawPivotTableWhere(this.rowIndex,h+1),this.scrollX.scrollX_AREA.scrollLeft+=this.cellWidth):s<this.colIndex&&(this._drawPivotTableWhere(this.rowIndex,h-1),this.scrollX.scrollX_AREA.scrollLeft-=this.cellWidth),this.setFocusedCell(n,s,i),this.scrollEvent=!1,!0}return this.options.focusFlow,
this.editingTD?this.editingTD.endCellEditMode(t):this.options.moveKeyEditMode&&this.setFocusedCell(n,l,!1),this.moveDirection=null,!1},g.prototype.moveVertical=function(t,e,i){if(this.moveDirection="row","false"==this.options.focusMove||"horizontal"==this.options.focusMove)return!1;var o=this.getLastFocusedCell(),s=o.focusedRowIndex,a=o.focusedColIndex,n=this.pivotData.rowKeys.length,l=a,r=s;switch(e){case"up":if((r=s-1)<0)return;break;case"down":if((r=s+1)>n-1)return}var h=this.rowIndex;return h+Math.ceil(this.viewTotalCellHeight/this.cellHeight)-1<=r?(this._drawPivotTableWhere(h+1,this.colIndex),this.scrollY.scrollY_AREA.scrollTop+=this.cellHeight):r<this.rowIndex&&(this._drawPivotTableWhere(h-1,this.colIndex),this.scrollY.scrollY_AREA.scrollTop-=this.cellHeight),this.setFocusedCell(r,l,i),this.scrollEvent=!1,!0};var m=function(t,e,i){r.s.call(this,t,e,i)};m.prototype.initAsync=async function(){m.isImported||(await inquires("externalJS/underscore/underscore-min.js"),(!window.jQuery.ui||window.jQuery.ui&&window.jQuery.ui.version<"1.9.2")&&await inquires("externalJS/jquery/jquery-ui-1.9.2.custom.min.js"),await inquires("uiplugin/pivot/editablePivot.js"),await inquires("uiplugin/pivot/pivot_ko.js"),m.isImported=!0)},o.x.extend(m.prototype,r.s.prototype),o.x.extend(m.prototype,h.prototype),o.x.extend(m.prototype,d.prototype),o.x.extend(m.prototype,c.prototype),o.x.extend(m.prototype,p.prototype),o.x.extend(m.prototype,u.prototype),o.x.extend(m.prototype,v.prototype),o.x.extend(m.prototype,f.prototype),o.x.extend(m.prototype,g.prototype),m.prototype.defaultOptions={pluginType:"uiplugin.pivot",pluginName:"pivot",useConfig:!0,userEvents:["onrefresh","oncellclick"],dataList:"",rows:"",cols:"",vals:"",defaultAggregator:"Sum",valuesAxis:"row",sortFunction:"",columnNameFormatter:"",numberFormatter:"",headerDataNameFormatter:"",rendererOptions:"",refreshOptions:!1,renderMode:"full",autoFit:"",autoFitMinWidth:"",autoFitCellMinWidth:0,editable:!1,defalutCellWidth:80,cellMinWidth:0,cellMinHeight:20,fixedColumn:0,fixedRow:0,focusMode:"cell",keyMoveEditMode:!1,enterKeyMove:"edit",useShiftKey:!0,useCtrlKey:!0,focusMove:"true",focusFlow:"default",tabKeyEditMode:!0,grandTotalName:"value",allTotalName:"",showGrandTotal:!1,grandTotalDisplayType:"both",noColumnMove:!1,noResultMessageVisible:!1,noResultMessage:"",noResultMessageClass:"",noResultMessageStyle:"",excludeHiddenList:"",headerListOrder:"",headerListMouseOver:!1,headerListMouseOverColor:"",hiddenHeaderList:"",useNumberFormat:!1,useRepresentativeValue:!1,invalidMessage:"",autoPopupInvalidMessage:!1,digitsAfterDecimal:"",scaler:1,showZero:!1,decimalSep:".",thousandsSep:",",prefix:"",suffix:"",headerDataImageWidth:0,valueDataType:"number",undoRedo:!1,headerYMerge:!1,textAlign:"",headerTextAlign:"",headerXTextAlign:"",headerYTextAlign:"",bodyTextAlign:"",totalTextAlign:"",totalXTextAlign:"",totlaYTextAlign:"",chartLegendSeperator:"-",chartDataSeperator:"-",tooltipDisplay:!1,tooltipDisplayTime:0,tooltipClass:"",tooltipStyle:"",tooltipHide:"click",tooltipShowAlways:!1,tooltipFormatter:"",tooltipPositionX:"20",tooltipPositionY:"3+cellHeight",refreshLimit:1e3},m.prototype.initialize=function(t){try{this.initFlag=!1,this.focusedCell=[],this.deletedCell=[],this.colIndex=0,this.rowIndex=0,this.pivotDataArr=[],this.pivotSheetInfo={headerX:{axis:{rows:[],cols:[]},depth:[]},headerY:{axis:{vals:[]},depth:[]}},this.charWidth={},this.columnInfoList=[],this.firstRowStr=[],this.seperator=",",this.pivotLanguage="ko",this.isEditting=!1,this.usingColumn=[];var e=WebSquare.Elem.api.getElementsByTagName(t,"fieldInfo",s.v._XML_NAMESPACE.W2)[0],i=[];e&&(i=WebSquare.Elem.api.getElementsByTagName(e,"field",s.v._XML_NAMESPACE.W2));for(var n=0;n<i.length;n++){var l=i[n],r=WebSquare.Parser.parseAttribute(l);null!=r.sortOrder&&(r.sortOrder=r.sortOrder.split(this.seperator)),this.usingColumn.push(r.id),this.columnInfoList.push(r)}this._dataList=null,this.options.dataList=this.options.dataList.wq_replaceAll("data:",""),
this.options.noResultMessage=this.options.noResultMessage||WebSquare.language.getMessage("Grid_noResultMessage")||"  .",this.options.headerTextAlign=this.options.headerTextAlign||this.options.textAlign,this.options.bodyTextAlign=this.options.bodyTextAlign||this.options.textAlign,this.options.totalTextAlign=this.options.totalTextAlign||this.options.bodyTextAlign||this.options.textAlign,this.options.totalYTextAlign=this.options.totalYTextAlign||this.options.totalTextAlign,this.options.totalXTextAlign=this.options.totalXTextAlign||this.options.totalTextAlign,this.options.pivotCsvUploadPopupURL=this.options.pivotCsvUploadPopupURL||o.x.baseURI+WebSquare.BootLoader.inquiresPath("uiplugin/pivot/upload/pivotCSVUpload.html"),this.options.pivotCsvDownloadURL=this.options.pivotCsvDownloadURL||WebSquare.baseServletURI+"pivotToCSV.wq",this.options.pivotCsvUploadURL=this.options.pivotCsvUploadURL||WebSquare.baseServletURI+"csvToPivot.wq",this.options.pivotExcelUploadPopupURL=this.options.pivotExcelUploadPopupURL||o.x.baseURI+WebSquare.BootLoader.inquiresPath("uiplugin/pivot/upload/pivotExcelUpload.html"),this.options.pivotExcelDownloadURL=this.pivotExcelDownloadURL||WebSquare.baseServletURI+"pivotToExcel.wq",this.options.pivotExcelUploadURL=this.options.pivotExcelUploadURL||WebSquare.baseServletURI+"excelToPivot.wq",this._aggregatorsName=["Count","Count Unique Values","List Unique Values","Sum","Integer Sum","Average","Minimum","Maximum","Median","Stdev"]}catch(t){a.w.printStackTrace(t)}},m.prototype.toHTML=function(){try{var t=[],e=""==this.options.style?"":"style='"+this.options.style+"'";return t.push("<div id='"+this.id+"' "+e+" class='w2editablePivot "+this.options.className+"'>"),t.push("</div>"),t.join("")}catch(t){a.w.printStackTrace(t)}},m.prototype.setAction=function(){try{this.scrollX={startColIndex:0},this.scrollY={startRowIndex:0},this.spanInfo={spanX:{depth:{}},spanY:{depth:{}}},this.mappingDataInfoByKey={},this.mappingDataInfoByRowIndex={},this.colWidthInfo={},this.pivotDOM={tdMap:{}},this.initializeEvent(),l.D.setInterval(this.checkResize,{key:this.id+"_checkResize",caller:this,delay:200})}catch(t){a.w.printStackTrace(t)}},m.prototype.setCharWidth=function(){try{this.charWidth.emptyString=3;for(var t=33;t<=126;t++){var e=String.fromCharCode(t);this.charWidth[t.toString()]=l.D.getWidth(e)}}catch(t){a.w.printStackTrace(t,null,this)}},m.prototype.onComplete=function(){try{this.initFlag=!0,this.setCharWidth(),this.refreshItemset({type:"render",refresh:!1}),r.s.prototype.onComplete.call(this)}catch(t){a.w.printStackTrace(t,null,this)}},m.prototype.checkResize=function(){try{if(this.render&&0==this.initFlag){var t=this.render.offsetWidth,e=this.render.offsetHeight;if(t>0&&e>0)0!=t-this.resizeObj.width&&(0==this.resizeObj.width?this.refreshRender(!0):this.resizeContentArea());this.resizeObj={width:t,height:e,scrollLeft:this.resizeObj.scrollLeft,scrollTop:this.resizeObj.scrollTop,clientWidth:this.resizeObj.clientWidth}}}catch(t){a.w.printStackTrace(t,null,this)}},m.prototype.refreshItemset=function(t){try{if("cell"==t.type){t.type="other",t.valAttrColID=this.pivotData.valAttrs[0];for(var e=this.pivotData.valAttrs,i=this.pivotData.colAttrs,o=this.pivotData.rowAttrs,s=0;s<e.length;s++)if(e[s]==t.colID){"true"===this.options.editablePivotMode?t.type="cell":t.type="render";break}for(var n=0;n<i.length;n++)if(i[n]==t.colID){t.type="render";break}for(n=0;n<o.length;n++)if(o[n]==t.colID){t.type="render";break}}switch(t.type){case"cell":this.refreshCell(t);break;case"render":this.refreshRender(t.refresh)}}catch(t){a.w.printStackTrace(t)}},m.prototype.refreshCell=function(t){try{"cell"==t.type&&this.pivotData.updateRecord({record:this.getRecord(t.rowIndex,t.colID),colKey:this.mappingDataInfoByRowIndex[t.rowIndex][t.colID].colKey,rowKey:this.mappingDataInfoByRowIndex[t.rowIndex][t.colID].rowKey,val:t.colID,oldValue:t.oldValue,rowIndex:t.rowIndex}),this.refreshPivotCell(t)}catch(t){a.w.printStackTrace(t)}},
m.prototype.refreshRender=function(t){try{var e=this.options.dataList;null!=this.scope_obj&&(e=this.scope_obj.id+"_"+this.options.dataList);var i=WebSquare.DataCollection.comp[e];null==this._dataList&&null!=i&&(i.addChild(this),i=WebSquare.DataCollection.api.getObj(i),this._dataList=i,this.modelControl.isDataCollectionItemsetBinded=!0,this.modelControl.useItemset=!0);for(var o=[],s=this.options.excludeHiddenList.split(this.seperator),r=0;r<s.length;r++){-1!=(u=this.usingColumn.indexOf(s[r]))&&this.usingColumn.splice(u,1)}var h=[];if(i){var d=i.options.depthColumn?i.getTotalRow():i.filteredRowIndexArr.length,c=i.cellIdList.length;for(r=0;r<i.cellIdList.length;r++)h[r]=!1;for(var p=0;p<this.usingColumn.length;p++){var u;h[u=i.cellIdList.indexOf(this.usingColumn[p])]=!0}for(r=0;r<d;r++){var v={},f=i.options.depthColumn?r:i.filteredRowIndexArr[r];for(p=0;p<i.cellIdList.length;p++)if(1==h[p]){var g=i.cellIdList[p],m=i.cellInfoHash[g]||{options:{}};m&&("expression"==m.options.inputType?v[m.id]=m.getExpressionValue(f):(v[i.cellIdList[p]]=i.dataArr[f*c+p],null==v[i.cellIdList[p]]&&(v[i.cellIdList[p]]="")))}o[r]=v}this.data=o,0==this.createdPivot&&!0===this.options.undoRedo&&this._dataList._undoRedoMultiHistoryClear()}"column"==this.options.valuesAxis&&(this.options.valuesAxis="col"),this.colIndex=0,this.rowIndex=0,this.scrollX.startColIndex=0,this.scrollY.startRowIndex=0;var y,w={},C={},x={},b={},T={},I=[],D=[];this.options.columnNameFormatter&&"function"!=typeof(y=l.D.getGlobalFunction(this.options.columnNameFormatter,this.scope_id))&&(y=null);for(r=0;r<this.columnInfoList.length;r++){var A=this.columnInfoList[r];"function"==typeof y?(w[A.id]=y(A.id),A.name=w[A.id]):w[A.id]=A.name,A.aggregator&&(C[A.id]=A.aggregator),A.exclusions?x[A.id]=A.exclusions.split(this.seperator):A.inclusions&&(b[A.id]=A.inclusions.split(this.seperator)),T[A.id]=r,"false"==A.dragToHidden&&D.push(A.id),I.push(A.id)}var S=this.id,E=this.options.aggregatorName?this.options.aggregatorName:this.options.defaultAggregator,L={};if("List Unique Values"!=E)for(r=0;r<this._aggregatorsName.length;r++){var M=this._aggregatorsName[r],k=this.getAggregatorTemplate(M);if(k){var _,N;if(1==this.options.useNumberFormat)N="Count"==M||"Count Unique Values"==M||"Integer Sum"==M?0:parseInt(this.options.digitsAfterDecimal?this.options.digitsAfterDecimal:0),_=$.pivotUtilities.numberFormat({digitsAfterDecimal:N,scaler:this.options.scaler,showZero:this.options.showZero,decimalSep:this.options.decimalSep,thousandsSep:this.options.thousandsSep,useNumberFormat:this.options.useNumberFormat,prefix:this.options.prefix,suffix:this.options.suffix});L[M]="Stdev"===M?k(1,_):k(_)}}this.options.numberFormatter&&(this.numberFormatter=l.D.getGlobalFunction(this.options.numberFormatter,this.scope_id),"function"!=typeof this.numberFormatter&&(this.numberFormatter=null)),this.options.headerDataNameFormatter&&(this.headerDataNameFormatter=l.D.getGlobalFunction(this.options.headerDataNameFormatter,this.scope_id),"function"!=typeof this.headerDataNameFormatter&&(this.headerDataNameFormatter=null)),this.options.userSetValueFunction&&(this.userSetValueFunction=l.D.getGlobalFunction(this.options.userSetValueFunction,this.scope_id),"function"!=typeof this.userSetValueFunction&&(this.userSetValueFunction=null));var F=this,W=l.D.getGlobalFunction(this.options.sortFunction,this.scope_id);"function"!=typeof W&&(W=function(t){var e=T[t],i=l.D.getComponentById(S);return null!=i&&null!=e&&null!=i.columnInfoList[e].sortOrder?$.pivotUtilities.sortAs(i.columnInfoList[e].sortOrder):null!=i&&t==i.options.grandTotalName&&null==e?$.pivotUtilities.sortAs(i.options.vals.split(i.seperator)):void 0});var R={rows:this.options.rows.split(this.seperator),cols:this.options.cols.split(this.seperator),vals:this.options.vals.split(this.seperator),valuesAxis:this.options.valuesAxis,aggregatorName:E,useRepresentativeValue:this.options.useRepresentativeValue,aggregators:L,aggregatorList:C,exclusions:x,inclusions:b,attributeLabels:w,
pivotColumns:I,rejectDragtoHiddenColumns:D,hiddenAttributes:this.options.excludeHiddenList.split(this.seperator),numberFormatter:this.numberFormatter,headerDataNameFormatter:this.headerDataNameFormatter,grandTotalName:this.options.grandTotalName,onRefresh:function(t){F.initFlag=!1,F.resizeObj={width:F.render.offsetWidth,height:F.render.offsetHeight,clientWidth:F.render.clientWidth},F.focusedCell=[],n.B.fireEvent(l.D.getComponentById(S),"onrefresh",t),F.displayNoResultMessage()},sorters:W};if(this.options.unusedAttrsVertical&&"true"===this.options.unusedAttrsVertical&&(R.unusedAttrsVertical=!0),""!==this.options.rendererOptions)try{R.rendererOptions=WebSquare.jsonUtil.getJSONByPath(window,this.options.rendererOptions),"string"==typeof R.rendererOptions&&(R.rendererOptions=JSON.parse(R.rendererOptions))}catch(t){a.w.printStackTrace(t)}"compact"==this.options.renderMode&&(this.options.hiddenHeaderList="col,row,val,hidden"),$("#"+this.id).pivotUI(o,R,t||this.options.refreshOptions,this.pivotLanguage,this),this.isHiddenHeader?this.setHeaderDisplay(this.isHiddenHeader):"true"==this.options.hideHeader&&this.setHeaderDisplay([!1,!1,!1,!1])}catch(t){a.w.printStackTrace(t)}},m.prototype.getAggregatorTemplate=function(t){var e;switch(t){case"UniqueValue":e=$.pivotUtilities.aggregatorTemplates.uniqueValue;break;case"Count":e=$.pivotUtilities.aggregatorTemplates.count;break;case"Count Unique Values":e=$.pivotUtilities.aggregatorTemplates.countUnique;break;case"Sum":case"Integer Sum":e=$.pivotUtilities.aggregatorTemplates.sum;break;case"Average":e=$.pivotUtilities.aggregatorTemplates.average;break;case"Minimum":e=$.pivotUtilities.aggregatorTemplates.min;break;case"Maximum":e=$.pivotUtilities.aggregatorTemplates.max;break;case"Median":e=$.pivotUtilities.aggregatorTemplates.median;break;case"Stdev":e=$.pivotUtilities.aggregatorTemplates.stdev}return e},m.prototype.setOption=function(t,e){try{for(var i in t)this.options[i]=t[i];this.usingColumn=[];for(var o=0;o<this.columnInfoList.length;o++)this.columnInfoList[o].representativeValue&&(this.columnInfoList[o].inclusions=null),this.usingColumn.push(this.columnInfoList[o].id);if(0!=e)if(1==this.createdPivot)this.refreshItemset({type:"render",refresh:!0});else{var s=this;setTimeout((function(){s.refreshItemset({type:"render",refresh:!0})}),100)}}catch(t){a.w.printStackTrace(t)}},m.prototype.getOption=function(){try{return o.x.extend({},this.options)}catch(t){a.w.printStackTrace(t)}},m.prototype.setFieldOption=function(t){try{for(var e in t)for(var i=t[e],o=0;o<this.columnInfoList.length;o++)this.columnInfoList[o].id==i.id&&(i.representativeColID&&(this.columnInfoList[o].representativeColID=i.representativeColID),i.representativeValue&&(this.columnInfoList[o].representativeValue=i.representativeValue),i.dragToHidden&&(this.columnInfoList[o].dragToHidden=i.dragToHidden),i.sortOrder&&(this.columnInfoList[o].sortOrder=i.sortOrder.split(this.seperator)));this.columnInfoList}catch(t){a.w.printStackTrace(t)}},m.prototype.setRows=function(t){try{"string"==typeof t&&(this.options.rows=t,this.refreshItemset({type:"render",refresh:!0}))}catch(t){a.w.printStackTrace(t)}},m.prototype.setCols=function(t){try{"string"==typeof t&&(this.options.cols=t,this.refreshItemset({type:"render",refresh:!0}))}catch(t){a.w.printStackTrace(t)}},m.prototype.setVals=function(t){try{"string"==typeof t&&(this.options.vals=t,this.refreshItemset({type:"render",refresh:!0}))}catch(t){a.w.printStackTrace(t)}},m.prototype.setColumnName=function(t){try{var e=!1;for(var i in t)for(var o=0;o<this.columnInfoList.length;o++)if(this.columnInfoList[o].id==i&&this.columnInfoList[o].name!=t[i]){this.columnInfoList[o].name=t[i],e=!0;break}e&&this.refreshItemset({type:"render",refresh:!0})}catch(t){a.w.printStackTrace(t)}},m.prototype.setPivotInit=function(){try{this.options.vals="",this.options.cols="",this.options.rows="",this.refreshItemset({type:"render",refresh:!0})}catch(t){a.w.printStackTrace(t)}},m.prototype.finalize=function(){try{
l.D.clearInterval(this.id+"_checkResize"),null!=this._dataList&&this._dataList.removeChild(this.id)}catch(t){a.w.printStackTrace(t)}}}}]);